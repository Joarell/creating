class e{#e;constructor(...e){this.#e=[...e]}get cmConvert(){return r.call(this.#e)}get inConvert(){return s.call(this.#e)}}function t(){const e=this.filter((e=>Number(e)?e:'string'==typeof e&&e?+e.trim():void 0));try{if(!e||e.length<1){throw new TypeError("Please, provide a value to be converted.")}}catch(e){return e}return e}function s(){const e=t.call(this);if(Array.isArray(e)){const e=2.54;return this.map((t=>+(t/e).toFixed(3)))}return e}function r(){const e=t.call(this);if(Array.isArray(e)){const e=2.54;return this.map((t=>+(t*e).toFixed(0)))}return e}class n{#e;constructor(...e){this.#e=[...e]}get regexSizes(){return a.call(this.#e)}}function a(){try{const e=this.map((e=>{const t=/[0-9]{1,3}/.test(e);return!!Number.isNaN(t)||t})),t="Not a valid entry to RegexChecker!";if(e.includes(!1))throw new TypeError(t)}catch(e){return e}}class i{#t;#s;#r;constructor(e,t,s){this.#t=+e,this.#s=+t,this.#r=+s}get cubCalcAir(){return function(e,t,s){const r=new n(e,t,s).regexSizes;if('object'==typeof r)return r;return+(e*t*s/6e3).toFixed(3)}(this.#t,this.#s,this.#r)}get cubArea(){return function(e,t,s){const r=new n(e,t,s).regexSizes;if('object'==typeof r)return r;return+(e*t*s/1e6).toFixed(3)}(this.#t,this.#s,this.#r)}}class o{constructor(e,t,s){try{if(!e||!t||!s)throw new TypeError("Please, provide a correct x, z or y value.")}catch(e){return e}this.x=+e,this.z=+t,this.y=+s}}class c extends o{#n;#t;#s;#r;constructor(e,t,s,r){super(t,s,r);try{if(!e||e.trim()<=0){const t=`Please, provide a valid code. Current: ${e}`;throw new TypeError(t)}}catch(e){return e}this.#n=""+e,this.#t=+t,this.#s=+s,this.#r=+r}get arr(){return[this.#n,this.#t,this.#s,this.#r]}get cAir(){return new i(this.#t,this.#s,this.#r).cubCalcAir}get cubed(){return new i(this.#t,this.#s,this.#r).cubArea}get autoConvert(){const t=new e(this.#t,this.#s,this.#r).cmConvert;return this.#t=t[0],this.#s=t[1],this.#r=t[2],[this.#n,this.#t,this.#s,this.#r]}get data(){return{code:this.#n,x:this.#t,z:this.#s,y:this.#r}}}class l{#a;constructor(e){return this.#a=e,this.#i()}#o(){return this.filter((e=>{if(e[1]>220||e[3]>220)return e}))}#i(){const{sorted:e}=this.#a,t=this.#o.call(e);return t.map((e=>{this.#a.sorted.splice(this.#a.sorted.indexOf(e),1)})),this.#a.largest=t,this.#a}}class u{#c;constructor(e){return this.#c=e,this.#l()}#u(e){e.map((e=>{this.sorted.splice(this.sorted.indexOf(e),1)}))}#h(){let{sorted:e,sameSize:t}=this.#c;let s=e.filter((e=>e[2]>10)),r=t.filter((e=>e[2]>10)),n=[];return s.map((e=>n.push(e))),this.#u.call(this.#c,s),r.map((e=>n.push(e))),this.#u.call(this.#c,r),e=null,t=null,s=null,r=null,this.#c.noCanvas=n,this.#c}#l(){return this.#h()}}class h{#a;constructor({sorted:e}){return this.#a=e,this.#d()}#m(){const e=[];return this.map((t=>{let s=0;if(t[2]<=10)for(s in this)e.includes(this[s])||(r=this[s],n=t,r[4]!==n[4]||r[0]===n[0])||e.push(this[s]);var r,n})),e}#p(e,t){const s=t[1],r=t[3],n=t[4];return e[1]===s&&e[3]===r&&e[4]===n}#g(e){const t=[];return e.map((s=>{let r=[],n=0;for(n in e)this.#p(e[n],s)&&!t.includes(e[n])&&r.push(e[n]);r.length>=4&&r.map((e=>{t.push(e)})),r=null})),t}#d(){const e=this.#m.call(this.#a),t=this.#g(e);return t.map((e=>{this.#a.splice(this.#a.indexOf(e),1)})),{sorted:this.#a,sameSize:t}}}class d{#a;constructor(e){return this.#a=e,this.#y()}#f(){return this.#a.map((e=>{const t=e.arr;return t.push(e.cubed),t}))}#b(e,t){if(e.length<=1)return e;const s=[],r=e.splice(0,1),n=[];return e.map((e=>{e[t]<=r[0][t]?s.push(e):n.push(e)})),this.#b(s,t).concat(r,this.#b(n,t))}#y(){const e=this.#f();return{sorted:this.#b(e,4)}}}class m{#a;constructor(e){return this.#a=e,this.#w()}#w(){const{noCanvas:e}=this.#a,t=e.filter((e=>{if(e[1]!==e[2]&&e[2]===e[3])return e}));return t.map((e=>{this.#a.noCanvas.splice(this.#a.noCanvas.indexOf(e),1)})),this.#a.tubes=t,this.#a}}class p{#v;#k;constructor(e){this.#v=e;const t=this.#C();return t&&'TypeError'===t.constructor.name?t:(this.#k=Object.assign(p,this.#x()),this.#k)}#x(){return this.#S(),this.#d(),this.#I(),this.#A(),this.#T(),Object.assign(p,{list:this.#v})}#C(){try{const e=e=>0===e.length||!e;if(!Array.isArray(this.#v)||e(this.#v)){throw new TypeError("Please, provide a type of 'ArtWork' object.")}if(this.#v.map((e=>"ArtWork"===e.constructor.name)).includes(!1)){throw new TypeError("Some work is not of the type 'ArtWork' object.")}}catch(e){return e}}#S(){this.#v=new d(this.#v)}#d(){this.#v=new h(this.#v)}#I(){this.#v=new u(this.#v)}#A(){this.#v=new l(this.#v)}#T(){this.#v=new m(this.#v)}}class g{#i;constructor(e){return e&&0!==e.length?(this.#i=e,this.#E()):{largest:!1}}#O(e,t){return[e[0]+23,e[1]+23+10*t,e[2]+28]}#z(e){const t=e[2]**2,s=57600,r=t>s?t-s:s-t,n=~~(100*Math.sqrt(r))/100;return[e[0],n,240]}#P(e){let t,s=0,r=0,n=0;return e.map((e=>{s<e[1]&&(s=e[1]),r<e[2]&&(r=e[2]),n<e[3]&&(n=e[3])})),t=this.#O([s,r,n],e.length),t}#B(e){let t,s;return t=this.#P(e),s=this.#z(t),s}#L(){let e,t=[];for(;this.#i.length;)e=this.#i.splice(0,3),t.push(this.#B(e)),t.push({works:e});return t}#E(){const e=this.#L();return this.largest={crates:e}}}class y{#a;#N;#F;constructor(e,t,s){return e&&0!==e.length?(this.#a=e,this.#N=s??4,this.#F=t,this.#U()):{standard:!1}}#U(){const e=[];return this.#R(e),this.#F?{crates:e,backUp:JSON.parse(JSON.stringify(e))}:{crates:e}}#$(e,t){if(e.length<=1)return e;const s=[],r=e.splice(0,1),n=[];return e.map((e=>{e[t]<=r[0][t]?s.push(e):n.push(e)})),this.#$(s,t).concat(r,this.#$(n,t))}#_(e,t){const s=e[0]+23,r=e[2]+28;let n=10*t.length+23,a=0,i=0;for(a in t)Object.entries(t[a]).map((e=>{e[1].map((e=>{e[2]>i&&(i=e[2])})),n+=i,i=0}));return[s,n,r]}#W(e,t,s){let r=e.length>5?e[3]/s[0]:e[1]/s[0],n=e.length>5?e[1]/s[2]:e[3]/s[2];return{avlX:t[0].x1<1?r+t[0].x1<=1:0,avlY:t[0].y1<1?n+t[0].y1<=1:0}}#q(e,t,s,r){const n=r[0].x1+t<=1,a=r[0].y1+s<=1;return 0===e[1].x2?((a||!n&&a)&&(e[1].x2+=+t.toFixed(2)),(e[1].y2<1&&n||!a)&&(e[1].y2+=+s.toFixed(2))):(e[1].x2<1&&!n&&!a?e[1].x2=+(e[1].x2+t).toFixed(2):n&&(e[1].y2=+(e[1].y2+s).toFixed(2)),e[1].x2>1&&(e[1]=1)),e}#D(e,t,s){const r=[...t],n=this.#W(e,t,s),a=t.length-1;return r.reverse().map(((r,i)=>{if(i>=a)return;let o,c;const l=r[0].length>5?r[0][3]:r[0][1],u=r[0].length>5?r[0][1]:r[0][3];o=n.avlX&&n.avlY?e.length>5?e[3]/s[0]:e[1]/s[0]:e.length>5?e[3]/l:e[1]/l,c=n.avlY?e.length>5?e[1]/s[2]:e[3]/s[2]:e.length>5?e[1]/u:e[3]/u,this.#q(r,o,c,t)}),0),t}#J(e,t,s,r){const{size:n}=e[0];return e.length>1?(e[0].x1+s<=1&&(e[0].x1=e[0].x1+s),e[0].y1+r<=1&&(e[0].y1=e[0].y1+r),1===e[0].y1&&(e[0].x2=e[0].x2+s),1===e[0].x1&&(e[0].y2=e[0].y2+r)):(e[0].x1=0!==e[0].x1?e[0].x1+s:s,e[0].y1=0!==e[0].y1?e[0].y1+r:r,e[0].x2=t[3]===n[2]?1:0,e[0].y2=t[1]===n[0]?1:0),e}#j(e,t,{size:s},r){const n=e.length>5?e[3]/s[0]:e[1]/s[0],a=e.length>5?e[1]/s[2]:e[3]/s[2];let i,o;return t.length>1?(this.#D(e,t,s),i=a+t[r][1].x2===1?1:0,o=n+t[r][1].y2===1?1:0):(i=a+t[0].x2===1?1:0,o=n+t[0].y2===1?1:0),this.#J(t,e,n,a),t.push([e,{x1:1,y1:1,x2:i,y2:o,prev:r}]),t}#X(e,t,{size:s}){let r,n,a=e[1],i=e[3],o=t.length,c=0;for(;o-- >=0;){if(r=a/s[0]<=1&&i/s[2]<=1,n=a/s[0]<=1&&i/s[2]<=1,r||n)return e.length>=6&&e.pop(),1===c&&5===e.length&&e.push("<i class=\"nf nf-oct-sync\"></i>"),this.#j(e,t,t[0]);[a,i]=[i,a],c=1}return t}#M(e,t,s,r){if(!r)return!1;const{x1:n,y2:a}=s[0],{x2:i}=s[r][1];let o;return o=n<1?i+e+(1-n)<=1:i+e<=1,o&&a+t<=1||o&&e<=i}#Y(e,t,s){const{size:r,x1:n,y1:a}=t[0];let i,o,c=e[1],l=e[3],u=!1,h=!1,d=!1,m=!0,p=t.length;for(1===s&&([c,l]=[l,c]),c/=r[0],l/=r[2];p>1&&m&&l<=1;)p--,o=this.#M(c,l,t,t[p][1].prev),i=t[p][0].length>5?t[p][0][1]:t[p][0][3],u=t[p][1].y2<=l&&n+c<=1,!u&&(h=t[p][1].x2<=c&&a+l<=1),!h&&(d=i>=e[3]&&o),(u||h||d)&&(m=!1);return!!(u||h||d)&&(d?t[p][1]?.prev:p)}#H(e,t){let s,r=!0,n=0;if(1===t.length)return this.#X(e,t,t[0]);for(;r;){if(s=this.#Y(e,t,n),s)return e.length>=6&&e.splice(5,1/0),1===n&&5===e.length&&e.push("<i class=\"nf nf-oct-sync\"></i>"),this.#j(e,t,t[0],s);1===n&&(r=!1),n=0===n?1:0}return t}#G(e,t,s){const{x1:r,y1:n,x2:a,y2:i}=t[0];if(!(1===r&&1===n&&1===a&&1===i||s<0))return this.#H(this.#a[s],t,t[0]),this.#G(e,t,s-1);t.map(((t,s)=>s>0?e.push(t[0]):0),0)}#Z(e,t){switch(this){case 1:e.unshift({layer1:t});break;case 2:e.push({layer2:t});break;case 3:e.push({layer3:t});break;case 4:e.push({layer4:t});break;case 5:e.push({layer5:t});break;default:return}}#V(e,t){let s=0;const r=[],n=this.#a.at(-1);return n[1]===t[0]&&n[3]===t[2]?(s++,this.#Z.call(s,e,[n]),this.#a.pop()):(this.#a.reverse().map((e=>{e[1]===t[0]&&r.push(e)})),r.map((t=>{s++,this.#Z.call(s,e,[t]),this.#a.splice(this.#a.indexOf(t),1)}))),s}#K(e){const t=new WeakSet;let s,r,n=[],a=[],i=!0,o=this.#V(n,e);for(;o++<this.#N||i&&this.#a.length;)r={size:e,x1:0,y1:0,x2:0,y2:0},s=this.#a.length-1,this.#G(a,[r],s),a.length>0&&(a.map((e=>this.#a.splice(this.#a.indexOf(e),1))),this.#Z.call(o,n,a),t.add(r),a=null,a=[]),i=1===this.#a.length&&o===this.#N;return n}#Q(e){const t=e.at(-1),s=e.filter((e=>{if(t[4]>=e[4])return e}));return this.#a.length===s.length}#ee(e){const t=this.#Q(e);let s=e.length,r=0,n=0,a=0;if(t)return[e.at(-1)[1],e.at(-1)[2],e.at(-1)[3]];for(;s--;)r+r+e[s][1]<=250?r+=e[s][1]:(r<e[s][1]&&e[s][1]<=250||e[s][1]>250)&&(r=e[s][1]),n=e[s][2]??n,a+a+e[s][3]<=132?a+=e[s][3]:(a<e[s][3]&&e[s][3]<=132||e[s][3]>132)&&(a=e[s][3]);return[r,n,a]}#te(e){let t=e.map((e=>(e.push(e[1]*e[3]),e)));return t=this.#$(t,5),t=t.map((e=>(e.pop(),e))),this.#a=t}#R(e){if(!this.#a.length)return;this.#te(this.#a);const t=this.#ee(this.#a),s=this.#K(t),r=this.#_(t,s);return e.push(r),e.push({works:s}),this.#R(e)}}class f{#se;constructor(e){return'crates ahead'===e[0]&&(this.#se=e,this.#re())}#$(e,t){if(e.length<=1)return e;const s=[],r=e.splice(0,1),n=[];let a=0;for(a in e)e[a][t]<=r[0][t]?s.push(e[a]):n.push(e[a]);return this.#$(s,t).concat(r,this.#$(n,t))}#ne(e,t,s){const r=e[t],{works:n}=r;return n.map((e=>{Object.entries(e).map((e=>{1===e.length?s.push(e[1].flat()):e[1].map((e=>s.push(e)))}))})),JSON.parse(JSON.stringify(s))}#ae(e,t){const s=new WeakSet;let r,n=0,a=!0,i=1===t.works.length?[...t.works[0]]:[...t.works];for(;n++<e.length&&a;)n%2==1&&(r=[...i],this.#ne(e,n,r),r=this.#$(r,4),r=new y(r,!1,4),2===r.crates.length&&(e.splice(n,1,r.crates[1]),e.splice(n-1,1,r.crates[0]),a=!1),s.add(r));return!a}#ie(e,t,s){return s<0?t:(s%2==1&&this.#ae(e,t[s])&&(t.splice(s-1,2),s=t.length),this.#ie(e,t,s-1))}#oe(e){let t,s,r=0;for(s in e){if(r%2==1&&5===e[s].works.length&&(t=e[s].works[4].layer5),t)break;r++}return!!t&&{info:s,works:t}}#ce(e,t){let s,r=[];return Object.entries(t).map((e=>{e[1].map((e=>{let t;for(t in e)e[t].length>0&&Array.isArray(e[t])&&e[t].map((e=>r.push(e)))}))})),e.map((e=>r.push(e))),s=this.#$(r,4),s}#le(e,t,s,r){return e[r].works.pop(),e[r-1][1]-=10,e.splice(t-1,1,s.crates[0]),e.splice(t,1,s.crates[1]),e}#ue(){const{crates:e}=this.#se.standardCrate,t=this.#oe(e);let s,r,n,a,i=0;if(t)for(a in e){if(!Array.isArray(e[a])&&e[a].works.length<=4&&(s=this.#ce(t.works,e[a]),r=new y(s,!1),n=2===r.crates.length&&r.crates[1].works.length<=4,n)){this.#le(e,i,r,t.info);break}i++}}#re(){const e=this.#se.sameSizeCrate.crates,t=this.#se.sameSizeCrate.backUp,s=this.#se.standardCrate.crates;let r;if(e&&s){if(r=e.length,this.#ie(s,e,r),e.length===t.length)return this.#se.sameSizeCrate.backUp=!1,void(this.#se.standardCrate.backUp=!1);this.#ue()}}}class b{#c;constructor(e){return e&&0!==e.length?(this.#c=e,this.#I()):{noCanvas:!1}}#$(e,t){if(e.length<=1)return e;const s=[],r=e.splice(0,1),n=[];return e.map((e=>{e[t]<=r[0][t]?s.push(e):n.push(e)})),this.#$(s,t).concat(r,this.#$(n,t))}#O(e){return[e[0]+23,e[1]+23,e[2]+28]}#he(e){let t,s=0,r=0,n=0,a=0;return t=e.length/2,e.map((e=>{t-- >0&&(s+=e[1],r<e[2]&&(r=e[2])),n=e[1],a<e[2]&&(a=e[2])})),n>s||(n=s),a+=r,{newX:n,newZ:a}}#de(e){const t=e.length>4&&e.length%2==0;let s,r=0,n=0,a=0;return e.map((e=>{r+=e[1],n=e[2]>n?e[2]:n,a=e[3]>a?e[3]:a})),(r>277||t)&&(s=this.#he(e),r=s.newX,n=s.newZ),this.#O([r,n,a])}#me(e,t){const s=e[1]===t[1]&&e[1]<277,r=e[2]===t[2]&&e[2]<177,n=e[3]<=132;return!!(s&&r&&n)}#pe(e,t,s,r){return r.length%2==0&&e>554&&2*t+10<177?r.length:0===s||r[0][1]>554?1:s}#ge(e){let t=10*e.length,s=0,r=0;const n=e[0];return e.map((e=>{const a=this.#me(e,n),i=e[2]-n[2],o=n[2]-e[2];(!0===a||(i>0&&i<=10||o>0&&o<=10))&&(r++,t+=e[1],s+=e[3])})),this.#pe(t,s,r,e)}#ye(e){if(!Array.isArray(e))return e;let t=e.map((e=>(e.push(e[1]*e[2]),e)));return t=this.#$(t,5),t=t.map((e=>(e.pop(),e))),this.#c=t}#I(){const e=[];let t;for(this.#ye(this.#c);this.#c.length>0;)t=this.#ge(this.#c),t=this.#c.splice(0,t),t.length>0?(e.push(this.#de(t)),e.push({works:t})):(e.push(this.#de(this.#c.splice(0,1))),e.push({works:t}));return{crates:e}}}class w{#c;constructor(e){return e&&0!==e.length?(this.#c=e,this.#fe()):{sameSize:!1}}#be(e){return[e[0]+23,e[1]+23,e[2]+28]}#we(e,t,s){const r=e.map((e=>{const r=e[0]+t[0]<=s[0],n=e[1]+t[1]<=s[1],a=e[2]+t[2]<=s[2];if(r&&n&&a)return e}));return void 0!==r[0]&&r.map((t=>e.splice(e.indexOf(t),1))),void 0!==r[0]}#ve(e,t){let s=[];return void 0!==t.map((t=>{const r=t[0]===e[0][0],n=t[2]===e[0][2],a=t[0]===e[0][0]-10,i=t[2]===e[0][2]-10;if(r&&n||a&&i)return t;if(s.length>0){if(this.#we(s,t,e))return t}else s.push(t)}))[0]}#ke(e,t){const s=e.shift(),r=1===t.length?t[0].length:t.length;let n,a,i,o;return s?(n=r%2+r/2,a=e[0],i=5*n,o=e[2]):(n=r%2+r,a=e[0],i=5*n,o=e[2]),this.#be([a,i,o])}#Ce(e,t){const s=t.length>3?[t[0][1],t[0][2],t[0][3]]:t;let r=e[0][0],n=e[0][1],a=e[0][2]+s[2],i=!1;return a>132&&r<132?([a,r]=[r,a],i=!0):a>e[0][2]&&(i=!0),[i,[r,n,a]]}#xe(e){let t,s=e.splice(0,1).flat(),r=e.splice(0,1).flat();return e.length>0&&(t=this.#ve(s,e)),t?(s=this.#Ce(s,e.splice(0,1)),e[0].map((e=>r[0][0].push(e))),e.splice(0,e[0].length)):r[0].length>10&&r[0].length%2==0?s=this.#Ce(s,r[0]):s.unshift(!1),Array.isArray(r[0][0])&&(r=r.flat()),{crate:this.#ke(s,r),works:r}}#Se(e){const t=[];let s;for(;e.length;)s=this.#xe(e),t.push(s.crate),t.push({works:s.works});return t}#Ie(){let e=this.#c[0][1],t=this.#c[0][2],s=this.#c[0][3],r=[[e,t,s]],n=[];return this.#c.map((a=>{a[2]<=10&&(a[1]!==e&&a[3]!==s&&(r.push([n]),e=a[1],t=a[2],s=a[3],r.push([e,t,s]),n=[]),n.push(a))})),r.push(n),r[1][0].length>=4?r:null}#fe(){let e=this.#Ie();if(null===e)return null;const t=this.#Se(e);return e=null,{crates:t,backUp:JSON.parse(JSON.stringify(t))}}}class v{#Ae;constructor(e){return e&&0!==e.length?(this.#Ae=e,this.#Te()):{tube:!1}}#Te(){return this.#Ee(),this.#Ae}#Oe(){let e=this[0][1],t=this[0][2],s=0;return this.map((r=>{e=r[1]>e?r[1]:e,t=r[2]>t?r[2]:t,s+=r[3]})),[e,t,s]}#ze(e,t){return[this[0]+e,this[1]+e,this[2]+t]}#Pe(){return[this[0][1]+18,this[0][2]+18,this[0][3]+25]}#Be(e){const t=this.#Oe.call(e);return this.#ze.call(t,18,25)}#Le(e,t){switch(e){case 1:return this.#Pe.call(t);case 2:case 3:case 4:return this.#Be(t)}}#Ne(e){const t=[];let s;for(;e.length>=3;)s=e.splice(0,3),t.push(this.#Le(s.length,s)),t.push({works:s});return t}#Fe(){const e=this.#Ae.filter((e=>{if(e[2]>40)return e}));return e.map((e=>{this.#Ae.splice(this.#Ae.indexOf(e),1)})),e}#Ee(){let e=[],t=[];const s=this.#Fe();for((s.length>0||s.length>3)&&t.push(this.#Ne(s));this.#Ae.length;)e=this.#Ae.splice(0,3),t.push(this.#Le(e.length,e)),t.push({works:e});return this.#Ae.length>=1&&(t.push(this.#Le(this.#Ae.length,this.#Ae)),t.push({works:this.#Ae})),this.#Ae={crates:t}}}class k{#v;#Ue;constructor(e){return e!==p?{crater:!1}:(this.#v=e.list,this.#Ue=['crates ahead'],Object.assign(k,this.#Re()))}#Re(){let e=0;const t=['tubeCrate','largestCrate','sameSizeCrate','noCanvasCrate','standardCrate'];for(e in this.#Be(),this.#$e(),this.#_e(),this.#We(),this.#qe(),this.#De(),this.#Ue)this.#Ue[e]?.hasOwnProperty('crates')&&t.includes(e)||'sameSizeCrate'!==e&&delete this.#Ue[e];return this.#Je(),this.#je(),this.#Xe(),this.#Me(),Array.isArray(this.#Ue?.sameSizeCrate?.backUp)&&(this.#Ye(),this.#He(),this.#Ge()),{crates:this.#Ue}}#Be(){const e=new v(this.#v?.tubes);this.#Ue.tubeCrate=e}#$e(){const e=new g(this.#v?.largest);this.#Ue.largestCrate=e}#_e(){const e=new w(this.#v?.sameSize);this.#Ue.sameSizeCrate=e}#We(){const e=new b(this.#v?.noCanvas);this.#Ue.noCanvasCrate=e}#qe(){const e=this.#Ue.sameSizeCrate.hasOwnProperty('crates'),t=new y(this.#v?.sorted,e);this.#Ue.standardCrate=t}#De(){new f(this.#Ue)}#Je(){let e=0;const t=[],s=e=>{Array.isArray(e)&&t.push(e)};for(e in this.#Ue)this.#Ue[e]?.crates?.map(s);this.#Ue.allCrates=t}#Ge(){let e,t,s=0;const r=[],n=e=>{Array.isArray(e)&&r.push(e)};for(s in this.#Ue)e='sameSizeCrate'===this.#Ue[s],t='standardCrate'===this.#Ue[s],(e||t)&&this.#Ue[s]?.backUp?.map(n),this.#Ue[s]?.crates?.map(n);this.#Ue.allCratesBackUp=r}#je(){let e=0;const t=e=>{if(Array.isArray(e)&&3===e.length){const t=e[0],s=e[1],r=e[2],n=new i(t,s,r).cubCalcAir;e.push(n)}};for(e in this.#Ue)this.#Ue[e]?.crates?.map(t);Array.isArray(this.#Ue?.sameSizeCrate?.backUp)&&(this.#Ue?.sameSizeCrate?.backUp?.map(t),this.#Ue?.standardCrate?.backUp?.map(t))}#Xe(){let e=0,t=[];const s=e=>{Array.isArray(e)&&t.push(e[3])};for(e in this.#Ue)this.#Ue[e]?.crates?.map(s);t=t.reduce(((e,t)=>+(e+t).toFixed(3)),0),this.#Ue.airCubTotal=t}#Ye(){let e,t,s=[],r=0;const n=e=>{Array.isArray(e)&&s.push(e[3])};for(r in this.#Ue)e='sameSizeCrate'===this.#Ue[r],t='standardCrate'===this.#Ue[r],e||t?this.#Ue[r]?.backUp?.map(n):e||t||this.#Ue[r]?.crates?.map(n);s=s.reduce(((e,t)=>+(e+t).toFixed(3)),0),this.#Ue.airCubTotalBackUp=s}#Ze(e){if(Array.isArray(e)){const t=e[0],s=e[1],r=e[2];return t>300||s>200||r>160?'CARGO':'PAX'}}#Me(){let e,t=0,s=0,r=0;for(r in this.#Ue)this.#Ue[r]?.crates?.map((r=>{e=this.#Ze(r),'PAX'===e?t++:'CARGO'===e&&s++}));this.#Ue.wichAirPort=[{PAX:t},{CARGO:s}]}#He(){let e,t,s,r=0,n=0,a=0;for(r in this.#Ue)e='sameSizeCrate'===this.#Ue[r],t='standardCrate'===this.#Ue[r],e||t?this.#Ue[r]?.backUp?.map((e=>{s=this.#Ze(e),'PAX'===s?n++:'CARGO'===s&&a++})):e||t||this.#Ue[r]?.crates?.map((e=>{s=this.#Ze(e),'PAX'===s?n++:'CARGO'===s&&a++}));this.#Ue.wichAirPortBackUp=[{PAX:n},{CARGO:a}]}}class C{#a;#Ve;constructor(e,t){return this.#a=e,this.#Ve=t,console.log(e),this.#Ke()}#Qe(){try{if(!Array.isArray(this.#a)){throw new TypeError("Please, provide a valid list.")}if(this.#a.some((e=>'ArtWork'!==e.constructor.name))){throw new TypeError("Please, provide a type of 'ArtWork' object list.")}if('cm'!==this.#Ve&&'in'!==this.#Ve){throw new TypeError("Please, provide a valid unit.")}}catch(e){return e}return'pass'}async#Ke(){let e;const t=this.#Qe();switch('pass'!==t?'error':'cm'===this.#Ve?'cm':'in'){case'error':return t;case'cm':return e=await this.#et(),e;case'in':return e=await this.#tt(),e}}#st(e){const t=e?.hasOwnProperty('crates'),s=e?.hasOwnProperty('backUp');return Array.isArray(e)?e.map(x):e?.hasOwnProperty('crates')?((t||s)&&(e.crates=e.crates.map((e=>4===e.length?x(e):(Array.isArray(e.works[0])?e.works=e.works.map(x):e.works=e.works.map(S),e)))),e):e}#rt(){return this.#a.map((e=>{const t=e.autoConvert,s=t[0],r=t[1],n=t[2],a=t[3];return new c(s,r,n,a)}))}#nt(e){let t=0;for(t in e)e[t].hasOwnProperty('crates')&&(e[t]=this.#st(e[t]));return e.sameSizeCrate?.hasOwnProperty('backUp')&&(e.airCubTotalBackUp=+(.061023*e.airCubTotalBackUp).toFixed(3),e.allCratesBackUp=this.#st(e.allCratesBackUp)),e.allCrates=this.#st(e.allCrates),e}async#et(){return await Promise.resolve(new p(this.#a)).then((e=>new k(e))).then((e=>e.crates)).catch((e=>e))}async#tt(){return await Promise.resolve(this.#rt()).then((e=>new p(e))).then((e=>new k(e))).then((e=>this.#nt(e.crates))).catch((e=>e))}}function x(t){const s=.061023;let r,n,a,i;switch(t.length){case 4:return n=t[0],a=t[1],i=t[2],r=Array.from(new e(n,a,i).inConvert),r.push(+(t[3]*s).toFixed(3)),r;case 5:return n=t[1],a=t[2],i=t[3],r=Array.from(new e(n,a,i).inConvert),r.unshift(t[0]),r.push(+(t[3]*s).toFixed(3)),r}}function S(e){let t=0;for(t in e)1===e[t].length?e[t]=x(e[t][0]):e[t]=e[t].map(x);return e}function I(e,t,s,r){switch(e){case 409:!async function(e,t,s){if(confirm("This estimate already exist. Would you like to update it?")){const r='/update/estimate';try{const n=await fetch(r,{method:"PUT",body:e,headers:t}).then((e=>e.status)).catch((e=>console.error(`ALERT ${e}`)));403===n&&I(n,s)}catch(e){alert(`ATTENTION: ${e}`)}}else alert("Not updated!")}(s,r,t);break;case 403:!async function(e){const t={'Content-Type':'application/json; charset=UTF-8'};try{await fetch("/shift/tokens",{method:"POST",headers:t}).then((e=>e.status)).catch((e=>console.error(`ALERT ${e}`))),A(e)}catch(e){alert(`ATTENTION: ${e}`)}}(t)}}async function A(e){const t=JSON.stringify(e),s={'Content-Type':'application/json; charset=UTF-8'};if(globalThis.navigator.onLine)try{I(await fetch("/new/estimate/",{method:"POST",body:t,headers:s}).then((e=>e.status)).catch((e=>console.error(`ALERT ${e}`))),e,t,s)}catch(e){alert(`ATTENTION: ${e}`)}else!function(e){const t=localStorage,s=t.getItem('offResults'),r=void 0!==s&&JSON.parse(s);r?(r.push(e),t.removeItem('offResults'),t.setItem('offResults',JSON.stringify(r))):t.setItem('offResults',JSON.stringify([e]))}(e.reference)}async function T(e){const t=await async function(e){const t=new Worker(new URL('./worker.IDB.crates.mjs',import.meta.url),{type:"module"});let s;return t.postMessage(e),s=await new Promise(((s,r)=>{t.onmessage=t=>{const{data:n}=t;n.reference===e?s(n):r(t)}})),s}(e),{reference:s,list:r,crates:n}=t;return A({reference:s,list:r,crates:Object.assign({},n)})}function E(){const e="Results",t=globalThis.indexedDB.open(e);t.onerror=e=>{alert(`ATTENTION! ${e.target.errorCode}`)},t.onupgradeneeded=t=>{let s;s=t.target.result.createObjectStore(e,{keyPath:"reference"}),s.createIndex("reference","reference",{unique:!0}),console.log('Done!')}}function O(e){const t=document.getElementById("input_estimate").value,s=globalThis.indexedDB.open("Results");s.onerror=e=>{alert(`ERROR: ${e.target.errorCode}`)},s.onsuccess=async s=>{const r=s.target.result.transaction("Results","readwrite").objectStore("Results"),n=r.get(e.reference);n.onsuccess=()=>{(void 0===n.result||r.delete(n.result.reference))&&r.add(e),async function(e){const t=globalThis.indexedDB.open("Results");t.onerror=e=>{alert(`WARNING: ${e.target.errorCode}`)},t.onsuccess=()=>{const s=t.result.transaction("Results").objectStore("Results").get(e);s.onsuccess=async()=>{const e=document.getElementById("input_estimate").value,t=s.result;globalThis.sessionStorage.setItem(e,JSON.stringify(t)),await T(e)}}}(t)}}}function z(){const e=F();let t=document.getElementById("count");return t.innerText=e?"Counting: "+e?.length:"Counting 0",t}function P(){let e;const t=document.getElementById("cub-meter");return e=F(),e=e?.reduce(((e,t)=>e+t.cubed),0)??0,t.innerText="Cub: "+(1e3*e/1e3).toFixed(3)+"mÂ³",t}function B(){let e,t,s;return s="Air-Cub: ",t=document.getElementById("cub-air"),e=F(),e=e?.reduce(((e,t)=>e+t.cAir),0)??0,t.innerText="Air-Cub: "+(1e3*e/1e3).toFixed(3),t}async function L(){let e,t;const s={},r=document.getElementById("input_estimate").value,n=sessionStorage.getItem('codes');confirm("Ready to crate all works?")&&n?(e=await async function(){const e=localStorage.getItem('metrica'),t='cm - centimeters'===e?'cm':'in',s=F();let r;return 1===e.length?alert("Oops! Sounds like you not added any work yet.\t\tPlease, try again!"):(r=await Promise.resolve(new C(s,t)),r)}(),s.reference=r,t=F(),s.list=t.map((e=>e.data)),s.crates=e,O(s),sessionStorage.setItem("pane1","populate"),sessionStorage.setItem("pane2","populate")):alert('Pease, add a some works to be crated!')}function N(){document.getElementById("input_code").value="",document.getElementById("input_code").select(),document.getElementById("input_length").value="",document.getElementById("input_depth").value="",document.getElementById("input_height").value=""}function F(){const e=localStorage,t=[];let s;const r=["doneList","mode","storage","currency","currency","metrica","refNumb"];return Object.entries(e).map((e=>{!r.includes(e[0])&&t.push(JSON.parse(e[1]))})),s=t.map((e=>new c(e.code,e.x,e.z,e.y))),s.length>0?s:void 0}function U(e){const t=function(e){let t=2;const s=/^[0-9\.0-9]{1,7}$/;for(;--t>=0;)if(!s.test(e[t]))switch(t){case 2:return alert("The provide HEIGHT is not a valid number.\t\t\t\t\tPlease, try again!"),!1;case 1:return alert("The provide DEPTH is not a valid number.\t\t\t\t\tPlease, try again!"),!1;case 0:return alert("The provide LENGTH is not a valid number.\t\t\t\t\tPlease, try again!"),!1}return e}([e[1],e[2],e[3]].map((e=>parseInt(e))));const s=/[^-a-z-A-Z-0-9]/g,r=document.getElementById("input_estimate").value;let n;for(n in n=0,localStorage.key(n))if(e[0]===localStorage.key(n))return alert(`${e[0]} already added to the list. Please, try again`),!1;return!0===(s.test(e[0])||s.test(r))?(alert("Found special character NOT allowed on \"Work code\",\t\t\tor \"Estimate\" input. Please, try again!"),!1):(function(){const e=localStorage.getItem("refNumb"),t=document.getElementById("input_estimate").value;e&&e!==t&&(confirm("ATTENTION! The refNumb has changed")?(localStorage.removeItem("refNumb"),localStorage.setItem("refNumb",t),document.getElementById("input_estimate").value=t):document.getElementById("input_estimate").value=e);localStorage.setItem("refNumb",t)}(),!!Array.isArray(t)&&new c(e[0],t[0],t[1],t[2]))}function R(){const e=document.getElementById("input_estimate").value,t=document.getElementById("input_code").value,s=document.getElementById("input_length").value,r=document.getElementById("input_depth").value,n=document.getElementById("input_height").value;let a;return e?""===(t&&s&&r&&n)?(alert("Oops! Do not forget to fill each field. Please, try again!"),N()):(a=U([t,s,r,n]),!1!==a&&(!function({code:e}){const t=sessionStorage,s=JSON.parse(t.getItem("codes"));let r;s?(r=Number.parseInt(s[s.length-1]),r+=1,s.push([r,e]),t.setItem("codes",JSON.stringify(s))):t.setItem("codes",JSON.stringify([[0,e]]))}(a.data),localStorage.setItem(a.data.code,JSON.stringify(a.data)),localStorage.setItem("storage","art-work"),z(),B(),P()),N()):alert("Attention! Please, add the \"Doc:\" reference field!")}function $(){const e=prompt("Please enter the work code to be removed:","code?");if(localStorage.getItem(e))!function(e){const t=sessionStorage,s=JSON.parse(t.getItem("codes"));let r=0;for(;s[r][1]!==e&&r<=s.length;)r++;s.splice(r,1),t.setItem("codes",JSON.stringify(s))}(e),localStorage.removeItem(e),z(),B(),P();else{if(null===e)return N();alert(`"${e}" was not found in the list. Please, try again!`)}return localStorage.setItem("storage","art-work"),N()}function _(e){const t=document.createDocumentFragment();return e.map((e=>{const s=document.createElement("option");s.textContent=e,t.appendChild(s)})),t}function W(e,t,s,r){const n=JSON.parse(sessionStorage.getItem("currency")),a=1e3,i=Number.parseFloat(s.value)===n[e],o=Number.parseFloat(r.value)===n[t];return e===t?i?r.value:s.value:i&&o?~~(n[e]*n[t]*a)/a:n[e]<n[t]?!0===i?~~(r.value/n[t]*n[e]*a)/a:~~(s.value*n[t]/n[e]*a)/a:!0===o?~~(s.value*n[t]/n[e]*a)/a:~~(r.value/n[t]*n[e]*a)/a}async function q(){const e=await fetch('/currency',{method:"GET",headers:{'Content-Type':'application/json; charset=UTF-8'}}).then((e=>e.json())).catch((e=>alert(`CurrencyError: ${e}!`))),{rates:t}=e.response,s=globalThis.sessionStorage;return t&&s.setItem("currency",JSON.stringify(t))}function D(e,t){const s=JSON.parse(sessionStorage.getItem("currency"));if(!s)return!1;t.value=s[e]}async function J(){await q(),await async function(){const e=JSON.parse(sessionStorage.getItem("currency")),t=document.getElementById("coin1"),s=document.getElementById("coin2"),r=Object.keys(e);if(!e)return"Error";t.appendChild(_(r)),s.appendChild(_(r))}()}function j(e,t,s,r){return"centimeters"===e?function(e,t,s,r){const n=2.54,a=.01,i=X(e,t);if(e===t)return s.value>r.value?s.value:r.value;if(i.checked1)return M(s,r,n,"in");return M(s,r,a,"m")}(e,t,s,r):"inches"===e?function(e,t,s,r){const n=.393,a=.0254,i=X(e,t);if(e===t)return s.value>r.value?s.value:r.value;if(i.checked2)return M(s,r,n,"cm");return M(s,r,a,"m")}(e,t,s,r):function(e,t,s,r){const n=.01,a=.0254,i=X(e,t);if(e===t)return s.value>r.value?s.value:r.value;if(i.checked3)return M(s,r,n,"cm");return M(s,r,a,"in")}(e,t,s,r)}function X(e,t){return{checked1:"centimeters"===e&&"inches"===t,checked2:"inches"===e&&"centimeters"===t,checked3:"meters"===e&&"centimeters"===t}}function M(e,t,s,r){const n=1e3;return"m"!==r?e.value>t.value?~~(e.value/s*n)/n:~~(t.value*s*n)/n:e.value<t.value?~~(t.value/s*n)/n:~~(e.value*s*n)/n}function Y(e,t,s){return+(e/s*t).toFixed(3)}function H(e,t){return e>=1024?function(e){const t=800;let s,r;e[0]>e[1]?(s=t,r=+(e[1]/e[0]*t).toFixed(0)):(r=t,s=+(e[0]/e[1]*t).toFixed(0));return{x:s,y:r}}(t):function(e){const t=.87,s=globalThis.screen.availWidth*t,r=globalThis.screen.availHeight*t;let n,a;e[0]>e[1]?(n=s,a=+(e[1]/e[0]*r).toFixed(0)):(a=r,n=+(e[0]/e[1]*s).toFixed(0));return{x:n,y:a}}(t)}class G{#at;#Ae;#it;constructor({works:e},t,s){return this.#at=t,this.#it=[s[0]+5,s[1],s[2]+3],this.#Ae=Array.isArray(e[0])?e:[e],this.#ot()}#ct({x:e,y:t}){const s=document.createElementNS("http://www.w3.org/2000/svg","rect"),r=t.length>1?Z(t):0;return s.setAttribute("x",1),s.setAttribute("y",r+1),s.setAttribute("width",e.at(-1)-20),s.setAttribute("height",t.at(-1)-20),s}#lt({x:e,y:t},s){const r=document.createElementNS("http://www.w3.org/2000/svg","text"),n=e.at(-1),a=.5*t.at(-1),i=.5*n-10*s.length*.5,o=1===t.length?a:Z(t)+a;return r.setAttribute("x",i),r.setAttribute("y",o),r.innerHTML=s[0],r}#ot(){const e=document.createDocumentFragment(),t=[],s=[];let r;return this.#Ae.map((n=>{t.push(Y(n[1],this.#at.x,this.#it[0])),s.push(Y(n[3],this.#at.y,this.#it[2])),e.appendChild(this.#ct({x:t,y:s})),r=[{x:t,y:s},n,this.#it],e.appendChild(this.#lt.apply(null,r))})),e}}function Z(e){let t;return 2===e.length?e.at(-2):(t=e.reduce(((e,t)=>e+t),0),t-e.at(-1))}class V{#ut;#ht;#it;#dt;constructor({works:e},t,s,r){return this.#ht=t,this.#dt=JSON.parse(JSON.stringify(t)),this.#it=s,this.#ut=Object.values(e[r])[0],this.#dt.x2=this.#dt.x,this.#dt.y2=this.#dt.y,this.#mt()}#ct({next:e,pos:t,values:s}){const r=document.createElementNS("http://www.w3.org/2000/svg","rect"),n=this.#ht.x,a=this.#ht.y;return r.setAttribute("x",t[0]+1),r.setAttribute("y",t[1]+0+1),s[0]>=n||t[0]+s[0]+1>=n?r.setAttribute("width",s[0]-20):r.setAttribute("width",s[0]),s[1]+0>=a||t[1]+s[1]>=a?r.setAttribute("height",s[1]-20):r.setAttribute("height",s[1]),r}#lt({next:e,pos:t,values:s},r){const n=document.createElementNS("http://www.w3.org/2000/svg","text");let a,i;return a=t[0]+.5*s[0],i=t[1]+0+.5*s[1],n.setAttribute("x",a-7*r.length*.5),n.setAttribute("y",i),n.innerHTML=r,n}#pt(e,t){const s=this.#dt.y>0&&t<=this.#dt.y,r=this.#dt.x>0&&e<=this.#dt.x;let n,a;s&&(this.#dt.y-=t),r&&(this.#dt.x-=e),n=0===this.#dt.y,a=0===this.#dt.x,n&&(this.#dt.x2-=e),a&&(this.#dt.y2-=t)}#gt(e,t,s,r){return Object.entries(t).map((t=>{const{fillX:n,fillY:a,next:i}=t[1],o=+(s/t[1].values[0]).toFixed(2),c=+(r/t[1].values[1]).toFixed(2),l=e.y===i[1]&&n+o<=1,u=e.x===i[0]&&a+c<=1;l&&(t[1].fillX=+(n+o).toFixed(2)),u&&(t[1].fillY=+(a+c).toFixed(2)),t[1].fillX>=1&&(t[1].next[1]=null),t[1].fillY>=1&&(t[1].next[0]=null)})),this.#pt(s,r),t}#yt(e,t,s,r,n,a){let i,o,c,l;const u=this.#ht.x,h=this.#ht.y,d=r.x+s.next[0]===u||this.#dt.x===r.x,m=r.y+s.next[1]===h||this.#dt.y===r.y;return this.#gt(r,t,n,a),i=m&&r.y===s.next[1]?null:r.x+n,o=d&&r.x===s.next[0]?null:r.y+a,c=null===i||o>=h?1:0,l=null===o||i>=u?1:0,t[e]={values:[n,a],pos:[r.x,r.y],next:[i,o],fillX:c,fillY:l},t}#ft(e,t,s){let r,n;const{next:a,pos:i,values:o,fillX:c,fillY:l}=e,u=0===i[0]?a[0]:i[0],h=0===i[1]?a[1]:i[1],d=c+t/o[0]<=1,m=l+s/o[1]<=1;return u+t<=this.#ht.x?(r=a[0]+t<=this.#ht.x?a[0]:void 0,n=i[1]+s<=this.#ht.y?i[1]:void 0):h+s<=this.#ht.y&&(r=i[0]+t<=this.#ht.x?i[0]:void 0,n=a[1]+s<=this.#ht.y?a[1]:void 0),(0===r&&c>0||null===r)&&(r=void 0),!r&&this.#dt.y>=s&&(r=i[0]),!r&&!d&&m&&(r=c*o[0]+i[0]),0===n&&!m&&(n=void 0),0===n&&m&&(n=l*o[1]+i[1]),0===n&&0===this.#dt.x&&(n=a[1]),void 0!==r&&void 0!==n&&{x:r,y:n}}#bt(e,t,s,r){const n=r.at(-1);let a,i,o=r.length;for(i of r)if(o-- >1&&(a=this.#ft(e[i],t,s),a)){this.#yt(n,e,e[i],a,t,s);break}return e}#wt(e,t,s,r){let n,a,i,o;return 0===Object.entries(e).length?(n=this.#ht.x-t==0?null:t,a=this.#ht.y-s==0?null:s,i=this.#dt.x+t===this.#ht.x?1:0,o=this.#dt.y+s===this.#ht.y?1:0,e[r]={values:[t,s],pos:[0,0],next:[n,a],fillX:i,fillY:o},this.#pt(t,s)):this.#bt(e,t,s,r),e}#vt(e){const t=document.createDocumentFragment();let s;for(s in e)t.appendChild(this.#ct(e[s])),t.appendChild(this.#lt(e[s],s));return t}#mt(){let e,t;const s={},r=[];return this.#ut.map((async n=>{"<i class=\"nf nf-oct-sync\"></i>"===n.at(-1)?(e=Y(n[3],this.#ht.x,this.#it[0]),t=Y(n[1],this.#ht.y,this.#it[2])):(e=Y(n[1],this.#ht.x,this.#it[0]),t=Y(n[3],this.#ht.y,this.#it[2])),r.push(n[0]),await this.#wt(s,e,t,r)}),0),this.#vt(s)}}class K{#at;#ut;#it;constructor({works:e},t,s,r){return this.#at=t,this.#it=s,this.#ut=Array.isArray(e[0])?[e[r]]:e,this.#kt()}#ct({x:e,y:t}){const s=document.createElementNS("http://www.w3.org/2000/svg","rect"),r=t.length>1?Q(t):0;return s.setAttribute("x",1),s.setAttribute("y",r+1),s.setAttribute("width",e.at(-1)-20),s.setAttribute("height",t.at(-1)-20),s}#lt({x:e,y:t},s){const r=document.createElementNS("http://www.w3.org/2000/svg","text"),n=e.at(-1),a=.5*t.at(-1),i=.5*n-10*s.length*.5,o=1===t.length?a:Q(t)+a;return r.setAttribute("x",i),r.setAttribute("y",o),r.innerHTML=s[0],r}#kt(){const e=document.createDocumentFragment(),t=[],s=[];let r;return this.#ut.map((n=>{t.push(Y(n[1],this.#at.x,this.#it[0])),s.push(Y(n[3],this.#at.y,n[3])),e.appendChild(this.#ct({x:t,y:s})),r=[{x:t,y:s},n,this.#it],e.appendChild(this.#lt.apply(null,r))})),e}}function Q(e){let t;return 2===e.length?e.at(-2):(t=e.reduce(((e,t)=>e+t),0),t-e.at(-1))}class ee{#at;#ut;#it;constructor({works:e},t,s,r){return this.#at=t,this.#it=s,this.#ut=Array.isArray(e[0])?[e[r]]:e[0],this.#kt()}#ct({x:e,y:t}){const s=document.createElementNS("http://www.w3.org/2000/svg","rect"),r=t.length>1?te(t):0;return s.setAttribute("x",1),s.setAttribute("y",r+1),s.setAttribute("width",e.at(-1)-20),s.setAttribute("height",t.at(-1)-20),s}#lt({x:e,y:t},s){const r=document.createElementNS("http://www.w3.org/2000/svg","text"),n=e.at(-1),a=.5*t.at(-1),i=.5*n,o=1===t.length?a:te(t)+a;return r.setAttribute("x",i-10*s.length*.5),r.setAttribute("y",o),r.innerHTML=s[0],r}#kt(){const e=document.createDocumentFragment(),t=[],s=[];let r;return this.#ut.map((n=>{t.push(Y(n[1],this.#at.x,this.#it[0])),s.push(Y(n[3],this.#at.y,this.#it[2])),e.appendChild(this.#ct({x:t,y:s})),r=[{x:t,y:s},n,this.#it],e.appendChild(this.#lt.apply(null,r))})),e}}function te(e){let t;return 2===e.length?e.at(-2):(t=e.reduce(((e,t)=>e+t),0),t-e.at(-1))}class se{#ht;#Ct;#it;constructor({works:e},t,s){return this.#ht=t,this.#it=s,this.#Ct=e,this.#kt()}#xt(e,t){let s,r;const n=ne(e,t,this.#ht);return e.includes(0)||t.includes(0)?(s=n.x,r=n.y):(s=e.includes(0)||1!==e.length?n.x:0,r=t.includes(0)||e.includes(0)?n.y:0),{posX:s,posY:r}}#ct({X:e,Y:t}){const s=document.createElementNS("http://www.w3.org/2000/svg","rect"),r=this.#xt(e,t),{x:n,y:a}=this.#ht;return s.setAttribute("x",r.posX+1),s.setAttribute("y",r.posY+1),e.at(-1)>=n||r.posX+e.at(-1)+1>=n?s.setAttribute("width",e.at(-1)-20):s.setAttribute("width",e.at(-1)),t.at(-1)>=a||r.posY+t.at(-1)>=a?s.setAttribute("height",t.at(-1)-20):s.setAttribute("height",t.at(-1)),s}#lt({X:e,Y:t},s,r){const n=document.createElementNS("http://www.w3.org/2000/svg","text"),a=.5,i=+re(e).toFixed(0);let o,c;const l=ne(e,t,r);return e.includes(0)||t.includes(0)?(o=l.x+(e.at(-1)*a-10*s.length*a),c=l.y+t.at(-1)*a):(o=e.includes(0)?l.x(e.at(-1)*a-10*s.length*a):i+e.at(-1)*a,c=t.includes(0)||e.includes(0)?l.y+t.at(-1)*a:t.at(-1)*a),n.setAttribute("x",o),n.setAttribute("y",c),n.innerHTML=s[0],n}#St(e,t,s,r){let n=s,a=[],i=[];for(;n>=0&&0!==e[n];)a.push(e[n]),n--;for(n=s;n>=0&&0!==t[n];)i.push(t[n]),n--;a=a.reduce(((e,t)=>e+t),0),i=i.reduce(((e,t)=>e+t),0),a>=r.x&&e.push(0),i>=r.y&&t.push(0)}#kt(){const e=document.createDocumentFragment(),t=[],s=[];let r;return this.#Ct.map(((n,a)=>{t.push(Y(n[1],this.#ht.x,this.#it[0])),s.push(Y(n[2],this.#ht.y,this.#it[1])),e.appendChild(this.#ct({X:t,Y:s})),r=[{X:t,Y:s},n,this.#ht],e.appendChild(this.#lt.apply(null,r)),this.#St(t,s,a,this.#ht)})),e}}function re(e){let t;return 2===e.length?e.at(-2):(t=e.reduce(((e,t)=>e+t),0),t-e.at(-1))}function ne(e,t,s){let r,n,a,i=0,o=0;const c=re(e),l=re(t);return e.map((e=>0===e&&i++)),t.map((e=>0===e&&o++)),r=c-i*s.x,n=c<s.x||l<s.y?0:l-o*s.y,0===r&&t.includes(0)&&(a=t.indexOf(s.y),r=a>=0?e[a]:e[t.indexOf(0)-1]),n>=s.y&&(n=l-o*s.y-t.at(-1)),{x:r,y:n}}function ae({type:e,crate:t,works:s},r){const n=function(){const e=document.querySelector(".crate-layer");if(e.parentNode)for(;e.firstChild;)e.removeChild(e.firstChild);return e}(),a=globalThis.screen.availWidth,i=[t[0]-23,t[1]-23,t[2]-28];let o;switch(o=H(a,[i[0],i[2]]),n.setAttribute("width",o.x),n.setAttribute("height",o.y),e){case'tubeCrate':n.appendChild(new G(s,o,i));break;case'largestCrate':n.appendChild(new K(s,o,i,r));break;case'sameSizeCrate':n.appendChild(new ee(s,o,i,r));break;case'noCanvasCrate':o=H(a,[i[0],i[1]]),n.setAttribute("width",o.x),n.setAttribute("height",o.y),n.appendChild(new se(s,o,i));break;case'standardCrate':n.appendChild(new V(s,o,i,r))}return n}async function ie(){const e=localStorage.getItem("refNumb"),t=await async function(e){const t=new Worker(new URL('./worker.IDB.crates.mjs',import.meta.url),{type:"module"});let s;return t.postMessage(e),s=await new Promise(((s,r)=>{t.onmessage=t=>{const{data:n}=t;n.reference===e?s(n.crates):r(t)}})),s}(e),s=document.getElementById('selected-crate'),r='cm - centimeters'===localStorage.getItem("metrica")?'cm':'in';if(s.hasChildNodes())for(;s.firstChild;)s.removeChild(s.firstChild);s.innerHTML=t.allCrates.map(((e,t)=>`\n\t\t\t<option>\n\t\t\t\tCrate ${++t} - ${e[0]} x ${e[1]} x ${e[2]} - ${r}\n\t\t\t</option>\n\t\t`),0),localStorage.setItem('doneList',JSON.stringify({...t})),await le(t)}function oe(){const e=document.getElementById('layers'),t=function(){const e=JSON.parse(localStorage.getItem('doneList'));let t,s,r,n=document.getElementById('selected-crate').value.split(' ')[1];for(t in e)e[t]?.hasOwnProperty('crates')&&e[t].crates.map(((a,i)=>{Array.isArray(a)&&0==--n&&(s=e[t].crates[i+1],r={type:t,crate:a,works:s})}),0);return r}(),s=+sessionStorage.getItem('numLayer');e.appendChild(ae(t,s-1))}function ce(e,t,s){let r;return'sameSizeCrate'===s?e[s].crates.map(((e,s)=>{0===t&&void 0===r&&(r=e.works.length),(s%2==0||0===s)&&t--}),0):e[s].crates.map(((e,n)=>{0===t&&n%2==1&&(r='tubeCrate'===s||'noCanvasCrate'===s?1:e.works.length),(n%2==0||0===n)&&t--}),0),{layers:r,counter:t}}async function le(e){let t,s,r=+document.getElementById('selected-crate').value.split(' ')[1],n=e??JSON.parse(localStorage.getItem('doneList'));for(s in n)n[s].hasOwnProperty('crates')&&r>0&&n[s].crates.length>0&&(t=ce(n,r,s),r=t.counter);sessionStorage.setItem('layers',t.layers),sessionStorage.setItem('numLayer',1),ue()}function ue(e){const t=sessionStorage.getItem('layers'),s=document.getElementById('layer-count');s.innerText=void 0===e?`Current layer: 1 / ${t}`:`Current layer: ${e} / ${t}`}function he(e){const t=sessionStorage,s=Number.parseInt(t.getItem('layers')),r=Number.parseInt(t.getItem('numLayer'));let n;"next"===e.target.id||"layer-next"===e.target.id?(n=r+1,n<=s?(ue(n),t.setItem('numLayer',n),n--):(n=s-1,t.setItem('numLayer',s))):(n=r-1,n>=1?(ue(n),t.setItem('numLayer',n)):(n=1,t.setItem('numLayer',n))),de(),oe()}function de(){const e=document.querySelector(".crate-layer");if(e.hasChildNodes())for(;e.firstChild;)e.removeChild(e.firstChild)}function me(e){const t=sessionStorage.getItem('codes');e.map((e=>{'true'===e.ariaHidden&&t?(e.setAttribute("aria-hidden",!1),e.setAttribute("aria-expanded",!0)):(e.setAttribute("aria-hidden",!0),e.setAttribute("aria-expanded",!1))}))}async function pe(){const e=document.getElementById("input_estimate").value,t=document.querySelector(".plotter"),s=document.querySelector(".plotter__menu");if(!e)return alert("Please, start an 'Doc', add works and press the 'Crate' button.");me([t,s]),'false'===t.ariaHidden&&(await ie(),ge(),setTimeout((()=>globalThis.scroll({top:1e3,behavior:"smooth"})),1e3))}function ge(){const e=document.getElementById('layers'),t=function(){const e=JSON.parse(localStorage.getItem('doneList'));let t,s,r,n=document.getElementById('selected-crate').value.split(' ')[1];for(t in e)e[t]?.hasOwnProperty('crates')&&e[t].crates.map(((a,i)=>{Array.isArray(a)&&0==--n&&(s=e[t].crates[i+1],r={type:t,crate:a,works:s})}),0);return r}(),s=+sessionStorage.getItem('numLayer');e.appendChild(ae(t,s-1))}if(globalThis.onstorage=()=>{P(),B(),z()},globalThis.onload=()=>{const e=localStorage.getItem("mode");we(),null===e&&localStorage.setItem("mode","light"),ve(),setTimeout(be,1500)},!localStorage.getItem("metrica")){const e=document.getElementById("cm").value;localStorage.setItem("metrica",e)}function ye(){const e=localStorage.getItem("metrica"),t=confirm("Attention! You are going to change the measurement of the works.");if(e&&void 0!==e){if(t){return void('cm - centimeters'===localStorage.getItem('metrica')?localStorage.setItem("metrica","in - inches"):localStorage.setItem("metrica","cm - centimeters"))}}else localStorage.setItem("metrica",document.getElementById("cm").value);ve()}const fe=()=>{we(),L();const e=document.querySelector(".result");sessionStorage.getItem('codes')&&('true'===e.ariaHidden&&me([e]),setTimeout((()=>globalThis.scroll({top:300,behavior:"smooth"})),1e3))};function be(){const e=document.querySelector(".loading"),t=document.querySelector(".app"),s=document.querySelector(".footer-content");e.style.display="none",e.setAttribute("aria-hidden",!0),t.setAttribute("aria-hidden",!1),s.setAttribute("aria-hidden",!1)}function we(){const e=localStorage.getItem("refNumb");return e&&(document.getElementById("input_estimate").value=e),E(),P()&&B()&&z()}function ve(){const e=localStorage.getItem("metrica"),t=localStorage.getItem("mode"),s=document.body;switch(e){case'cm - centimeters':document.getElementById('cm').checked=!0;break;case'in - inches':document.getElementById('in').checked=!0}switch(t){case'light':document.getElementById('light-mode').checked=!0,s.classList.remove("dark-mode"),s.classList.toggle("light-mode");break;case'dark':document.getElementById('dark-mode').checked=!0,s.classList.remove("light-mode"),s.classList.toggle("dark-mode")}}function ke({works:e}){let t=[];const s=Array.isArray(e[0][0])?e[0]:e;return s?.map((e=>{let s;if(Array.isArray(e))return t.push(e);for(s in e)t.push(s),1===e[s].length?t.push(e[s][0]):Array.isArray(e[0])?e[s][0].map((e=>t.push(e))):e[s].map((e=>t.push(e)))})),t}function Ce(e){if(!e)return"There is no crates. Please, try again!";const t='cm - centimeters'===localStorage.getItem("metrica")?'cm':'in',s=e.map((e=>{let s;return'string'==typeof e?`LAYER layer ${e?.at(-1)}:`:e.length>=5?(s=`CODE: ${e[0]} - ${e[1]} x ${e[2]} x ${e[3]} - ${t}`,s):4===e.length?(s=`CRATE: ${e[0]} x ${e[1]} x ${e[2]} - ${t}`,s):void 0})),r=function(e,t){for(;t--;)e=(e=(e=(e=(e=e.replace('LAYER','\t')).replace('CODE: ','\t\t')).replace('"','')).replace('"','')).replace(',','\n');return e=(e=e.replace('[','')).replace(']','')}(JSON.stringify(s),s.length);navigator.clipboard.writeText(r)}function xe(){const e=new Worker(new URL('./worker.IDB.crates.mjs',import.meta.url),{type:"module"}),t=document.getElementById("input_estimate").value;if(!sessionStorage.getItem(t))return alert("Please, press the \"Crate\" button if already added works.");e.postMessage(t),e.onmessage=e=>!!Array.isArray(e.data.crates)&&function({crates:e}){return sessionStorage.setItem("copy1","done!"),Ce(e.allCrates)}(e.data)}function Se(){const e=new Worker(new URL('./worker.IDB.crates.mjs',import.meta.url),{type:"module"}),t=document.getElementById("input_estimate").value;if(!sessionStorage.getItem(t))return alert("Please, press the \"Crate\" button if already added works.");e.postMessage(t),e.onmessage=e=>function({crates:e}){let t,s,r=[];for(t in e)e[t].hasOwnProperty('crates')&&e[t].crates.map(((e,t)=>{switch(t%2){case 0:r.push(e);break;case 1:s=ke(e),s.map((e=>r.push(e))),s=null}}),0);return sessionStorage.setItem("copy2","done!"),Ce(r)}(e.data)}function Ie(e){localStorage.setItem("mode",e),function(e){const t=document.body.classList;t.remove("light-mode"),t.remove("dark-mode"),"dark"===e?t.add("dark-mode"):t.add("light-mode")}(e)}function Ae(e){const t=e.target.closest(".accordion-panel"),s=document.querySelector(".accordion-panel");if("body-app"===e.target.id)return function(e){let t,s,r;for(t in e)s=e.parentElement.querySelectorAll("button"),r=e.parentElement.querySelectorAll(".menu__input"),s.forEach((e=>{e.setAttribute("aria-expanded",!1)})),r.forEach((e=>{e.setAttribute("aria-hidden",!0)}))}(s);t&&function(e){const t=e.parentElement.querySelectorAll("button"),s=e.parentElement.querySelectorAll(".menu__input");t.forEach((e=>{e.setAttribute("aria-expanded",!1)})),s.forEach((e=>{e.setAttribute("aria-hidden",!0)})),function(e){e.querySelector("button").setAttribute("aria-expanded",!0),e.querySelector(".menu__input").setAttribute("aria-hidden",!1),globalThis.document.getElementById("estimate_getter").select()}(e)}(t)}function Te(e,t){e.ariaHidden&&(e.setAttribute("aria-expanded",!0),e.setAttribute("aria-hidden",!1)),setTimeout((()=>globalThis.scroll({top:1e3,behavior:"smooth"})),200),setTimeout(document.getElementById(t).click(),100)}function Ee(e){e.setAttribute("aria-expanded",!1),e.setAttribute("aria-hidden",!0)}function Oe(e){const t=[];return e.map((e=>{const{code:s,x:r,z:n,y:a}=e;t.push({code:s,x:r,z:n,y:a})})),t}async function ze(e){const t=new Worker(new URL('./panels/worker.IDB.crates.mjs',import.meta.url),{type:"module"}),s=await new Promise(((s,r)=>{t.postMessage(e),t.onmessage=e=>{void 0!==e?s(e.data):r(void 0)}}));if(s)document.getElementById("input_estimate").value=e,sessionStorage.setItem("FETCHED",JSON.stringify(s));else if(!s)return async function(e){const t=`/estimates/${e}`,s={'Content-Type':'application/json; charset=UTF-8'};if(globalThis.navigator.onLine)try{await fetch(t,{method:"GET",headers:s}).then((e=>e.json())).then(Pe).catch((e=>console.error(`ALERT ${e}`)))}catch(e){console.log(`ATTENTION: ${e}`),alert("Document not found! Please, try again.")}}(e)}function Pe(e){try{if(!e)throw new TypeError('Data not found!');{const{crates:t,works:s,reference_id:r}=e[0],n={crates:t,list:Oe(s.list),reference:r};document.getElementById("input_estimate").value=r,sessionStorage.setItem("FETCHED",JSON.stringify(n))}}catch(e){console.log(`ATTENTION: ${e}`),alert("Document not found! Please, try again.")}}function Be(){const e=document.getElementById("estimate_getter").value;return!function(e){switch(/[^-a-z-A-Z-0-9]/g.test(e)){case!0:return alert("Found special character NOT allowed. Please, try again!"),!0;case!1:return!1}}(e)&&ze(e)}async function Le(){if(confirm("Are you sure to logout?")){globalThis.location.replace('/otto/login/');try{await fetch("/logout",{method:"GET",cookie:"id=deleted; sessin=deleted; name=deleted; expires=Thu, 01 Jan 1970 00:00:00 GMT",headers:{'Content-Type':'application/json; charset=UTF-8'}}).then((e=>console.log(e))).catch((e=>console.error(`Alert ${e}`)))}catch(e){alert(`Attention: ${e}`)}}}globalThis.document.querySelector(".IO__press-mobile").addEventListener("click",(e=>{const{id:t}=e.target,s=document.querySelector(".fan-options");"menu-options"===t&&s.ariaHidden?(s.setAttribute("aria-expanded",!0),s.setAttribute("aria-hidden",!1)):(s.setAttribute("aria-expanded",!1),s.setAttribute("aria-hidden",!0)),function(e,t){let s;switch(e){case"fetch-mob":s=document.querySelector(".get-estimate"),Te(s,'search-btn'),Ee(t);break;case"currency-mob":s=document.querySelector(".exchange--content"),Te(s,'exchange-btn'),Ee(t),setTimeout((()=>{document.getElementById('exchange-header').click()}),250);break;case"units-mob":s=document.querySelector(".units-conversion"),Te(s,'units-btn'),Ee(t)}}(t,s)}),!0),globalThis.onkeydown=e=>{"Enter"===e.key&&!0===e.ctrlKey&&fe();!0===e.ctrlKey&&"V"===e.key&&pe()},globalThis.document.getElementById('main-app').addEventListener("click",(e=>{switch(e.target.id){case"body-app":case"seek-btn":case"search-header":case"units-header":case"button-seek":case"search-btn":case"unit-btn":case"units-btn":Ae(e);break;case"buttonInstall":!async function(){globalThis.hideInstallPromotion(),globalThis.deferredPrompt.prompt();const{outcome:e}=await deferredPrompt.userChoice;console.log(`User response to the install prompt: ${e}`),globalThis.deferredPrompt=null}();break;case"add-btn":R();break;case"remove-btn":$();break;case"clear-btn":(()=>{const e=confirm("Do you really want to delete the whole list?"),t=localStorage.getItem("mode"),s=localStorage.getItem("metrica"),r=document.querySelector(".result"),n=document.getElementById('layers'),a=document.querySelector(".plotter__menu");!0===e&&(z()&&B()&&P(),localStorage.clear(),sessionStorage.clear(),sessionStorage.setItem("clean","eraser"),localStorage.setItem("mode",t),localStorage.setItem("metrica",s),globalThis.document.getElementById("input_estimate").value="",me([r,n,a])),N(),document.getElementById("input_estimate").select()})();break;case"crate-btn":case"crate_btn":fe();break;case"copy-pane1":xe();break;case"copy-pane2":Se();break;case"logout":case"logout-btn":Le();break;case"exchange-header":J(),async function(){const e=sessionStorage.getItem("currency"),t=JSON.parse(sessionStorage.getItem("coin1")),s=JSON.parse(sessionStorage.getItem("coin2")),r=document.getElementById("coin1"),n=document.getElementById("coin2");null!==t&&(r.value=t),null!==s&&(n.value=s),null===e&&await q()}(),Ae(e);break;case"ex-btn":case"exchange-btn":J(),Ae(e);break;case"fetch-btn":Be();break;case"crate-layers":case"layer-crate":pe();break;case"previous":case"layer-prev":case"next":case"layer-next":he(e)}}),!0),globalThis.document.getElementById('main-app').addEventListener("change",(e=>{switch(e.target.id){case"input_estimate":E();break;case"in":case"cm":ye();break;case"dark-mode":Ie('dark');break;case"light-mode":Ie('light');break;case"coin1":!function(){const e=document.getElementById("coin1").value,t=document.getElementById("coin1-input");sessionStorage.setItem("coin1",JSON.stringify(e)),D(e,t)}();break;case"coin2":!function(){const e=document.getElementById("coin2").value,t=document.getElementById("coin2-input");sessionStorage.setItem("coin2",JSON.stringify(e)),D(e,t)}();break;case"units1":!function(){const e=globalThis.document.getElementById("input-unit1"),t=globalThis.document.getElementById("input-unit2");e.value=0,t.value=0}();break;case"units2":!function(){const e=globalThis.document.getElementById("input-unit1"),t=globalThis.document.getElementById("input-unit2");e.value=0,t.value=0}();break;case"selected-crate":le(),function(){const e=document.getElementById('selected-crate').value;de(),ge(e.split(' ')[1])}()}}),!0),globalThis.document.getElementById('main-app').addEventListener("input",(e=>{switch(e.target.id){case"coin1-input":!function(){const e=document.getElementById("coin1").value,t=document.getElementById("coin2").value,s=document.getElementById("coin1-input"),r=document.getElementById("coin2-input");D(t,r),r.value=`$ ${W(e,t,s,r)}`}();break;case"coin2-input":!function(){const e=document.getElementById("coin1").value,t=document.getElementById("coin2").value,s=document.getElementById("coin1-input"),r=document.getElementById("coin2-input");D(e,s),s.value=`$ ${W(e,t,s,r)}`}();break;case"input-unit1":!function(){const e=globalThis.document.getElementById("units1").value,t=globalThis.document.getElementById("units2").value,s=globalThis.document.getElementById("input-unit1"),r=globalThis.document.getElementById("input-unit2");r.value=0,r.value=j(e,t,s,r)}();break;case"input-unit2":!function(){const e=globalThis.document.getElementById("units1").value,t=globalThis.document.getElementById("units2").value,s=globalThis.document.getElementById("input-unit1"),r=globalThis.document.getElementById("input-unit2");s.value=0,s.value=j(e,t,s,r)}()}}),!0),globalThis.onsubmit=e=>{e.preventDefault()},globalThis.document.getElementById('estimate_getter').addEventListener('keypress',(e=>{const t=globalThis.document.getElementById('fetch-btn');'Enter'===e.key&&t.click()}),!0),await globalThis.navigator.serviceWorker.register('./sw.mjs'),globalThis.addEventListener('beforeinstallprompt',(e=>{e.preventDefault(),console.log('ð','beforeinstallprompt',e),globalThis.deferredPrompt=e,showInstallPromoiton(),console.log("'beforeinstallprompt' event was fired.")}));
