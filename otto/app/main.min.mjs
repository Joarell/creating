class Converter{#e;constructor(...e){this.#e=[...e]}get cmConvert(){return r.call(this.#e)}get inConvert(){return t.call(this.#e)}}function e(){const e=this.filter((e=>Number(e)?e:"string"==typeof e&&e?+e.trim():void 0));try{if(!e||e.length<1){throw new TypeError("Please, provide a value to be converted.")}}catch(e){return e}return e}function t(){const t=e.call(this);if(Array.isArray(t)){const e=2.54;return this.map((t=>+(t/e).toFixed(3)))}return t}function r(){const t=e.call(this);if(Array.isArray(t)){const e=2.54;return this.map((t=>+(t*e).toFixed(0)))}return t}class RegexChecker{#e;constructor(...e){this.#e=[...e]}get regexSizes(){return s.call(this.#e)}}function s(){try{const e=this.map((e=>{const t=/[0-9]{1,3}/.test(e);return!Number.isNaN(e)&&t})),t="Not a valid entry to RegexChecker!";if(e.includes(!1))throw new TypeError(t)}catch(e){return console.error(e),e}}class CubCalc{#t;#r;#s;constructor(e,t,r){this.#t=+e,this.#r=+t,this.#s=+r}get cubCalcAir(){return function(e,t,r){const s=new RegexChecker(e,t,r).regexSizes;if("object"==typeof s)return s;return+(e*t*r/6e3).toFixed(3)}(this.#t,this.#r,this.#s)}get cubArea(){return function(e,t,r){const s=new RegexChecker(e,t,r).regexSizes;if("object"==typeof s)return s;return+(e*t*r/1e6).toFixed(3)}(this.#t,this.#r,this.#s)}}class Hexaedro{constructor(e,t,r){try{if(!e||!t||!r)throw new TypeError("Please, provide a correct x, z or y value.")}catch(e){return e}this.x=+e,this.z=+t,this.y=+r}}class ArtWork extends Hexaedro{#n;#t;#r;#s;constructor(e,t,r,s){super(t,r,s);try{if(!e||e.trim()<=0){const t=`Please, provide a valid code. Current: ${e}`;throw new TypeError(t)}}catch(e){return e}this.#n=""+e,this.#t=+t,this.#r=+r,this.#s=+s}get arr(){return[this.#n,this.#t,this.#r,this.#s]}get cAir(){return new CubCalc(this.#t,this.#r,this.#s).cubCalcAir}get cubed(){return new CubCalc(this.#t,this.#r,this.#s).cubArea}get autoConvert(){const e=new Converter(this.#t,this.#r,this.#s).cmConvert;return this.#t=e[0],this.#r=e[1],this.#s=e[2],[this.#n,this.#t,this.#r,this.#s]}get data(){return{code:this.#n,x:this.#t,z:this.#r,y:this.#s}}}class ArrangerLargestCanvas{#a;constructor(e){return this.#a=e,this.#i()}#o(){return this.filter((e=>{if(e[1]>220||e[3]>220)return e}))}#i(){const{sorted:e}=this.#a,t=this.#o.call(e);return t.map((e=>{this.#a.sorted.splice(this.#a.sorted.indexOf(e),1)})),this.#a.largest=t,this.#a}}class ArrangerNoCanvas{#c;constructor(e){return this.#c=e,this.#l()}#u(e){e.map((e=>{this.sorted.splice(this.sorted.indexOf(e),1)}))}#h(){let{sorted:e,sameSize:t}=this.#c;let r=e.filter((e=>e[2]>10)),s=t.filter((e=>e[2]>10)),n=[];return r.map((e=>n.push(e))),this.#u.call(this.#c,r),s.map((e=>n.push(e))),this.#u.call(this.#c,s),e=null,t=null,r=null,s=null,this.#c.noCanvas=n,this.#c}#l(){return this.#h()}}class ArrangerSameSize{#a;constructor({sorted:e}){return this.#a=e,this.#d()}#p(){const e=[];return this.map((t=>{let r=0;if(t[2]<=10)for(r in this)e.includes(this[r])||(s=this[r],n=t,s[4]!==n[4]||s[0]===n[0])||e.push(this[r]);var s,n})),e}#m(e,t){const r=t[1],s=t[3],n=t[4];return e[1]===r&&e[3]===s&&e[4]===n}#g(e){const t=[];return e.map((r=>{let s=[],n=0;for(n in e)this.#m(e[n],r)&&!t.includes(e[n])&&s.push(e[n]);s.length>=4&&s.map((e=>{t.push(e)})),s=null})),t}#d(){const e=this.#p.call(this.#a),t=this.#g(e);return t.map((e=>{this.#a.splice(this.#a.indexOf(e),1)})),{sorted:this.#a,sameSize:t}}}class ArrangerStarter{#a;constructor(e){return this.#a=e,this.#y()}#f(){return this.#a.map((e=>{const t=e.arr;return t.push(e.cubed),t}))}#x(e,t){if(e.length<=1)return e;const r=[],s=e.splice(0,1),n=[];return e.map((e=>{e[t]<=s[0][t]?r.push(e):n.push(e)})),this.#x(r,t).concat(s,this.#x(n,t))}#y(){const e=this.#f();return{sorted:this.#x(e,4)}}}class ArrangerTube{#a;constructor(e){return this.#a=e,this.#v()}#v(){const{noCanvas:e}=this.#a,t=e.filter((e=>{const t=e[2]<35&&e[3]<35,r=e[2]===e[3];if(t&&r&&e[1]!==e[2]&&r)return e}));return t.map((e=>{this.#a.noCanvas.splice(this.#a.noCanvas.indexOf(e),1)})),this.#a.tubes=t,this.#a}}class Arranger{#C;#k;constructor(e){this.#C=e;const t=this.#b();return t&&"TypeError"===t.constructor.name?t:(this.#k=Object.assign(Arranger,this.#w()),this.#k)}#w(){return this.#S(),this.#d(),this.#A(),this.#I(),this.#T(),Object.assign(Arranger,{list:this.#C})}#b(){try{const e=e=>0===e.length||!e;if(!Array.isArray(this.#C)||e(this.#C)){throw new TypeError("Please, provide a type of 'ArtWork' object.")}if(this.#C.map((e=>"ArtWork"===e.constructor.name)).includes(!1)){throw new TypeError("Some work is not of the type 'ArtWork' object.")}}catch(e){return e}}#S(){this.#C=new ArrangerStarter(this.#C)}#d(){this.#C=new ArrangerSameSize(this.#C)}#A(){this.#C=new ArrangerNoCanvas(this.#C)}#I(){this.#C=new ArrangerLargestCanvas(this.#C)}#T(){this.#C=new ArrangerTube(this.#C)}}class CraterPythagoras{#i;constructor(e){return e&&0!==e.length?(this.#i=e,this.#E()):{largest:!1}}#z(e,t){return[e[0]+23,e[1]+23+10*t,e[2]+28]}#O(e){const t=e[2]**2,r=57600,s=t>r?t-r:r-t,n=~~(100*Math.sqrt(s))/100;return[e[0],n,240]}#P(e){let t,r=0,s=0,n=0;return e.map((e=>{r<e[1]&&(r=e[1]),s<e[2]&&(s=e[2]),n<e[3]&&(n=e[3])})),t=this.#z([r,s,n],e.length),t}#B(e){let t,r;return t=this.#P(e),r=this.#O(t),r}#L(){let e,t=[];for(;this.#i.length;)e=this.#i.splice(0,3),t.push(this.#B(e)),t.push({works:e});return t}#E(){const e=this.#L();return this.largest={crates:e}}}class CraterStandard{#a;#N;#X;constructor(e,t,r){return e&&0!==e.length?(this.#a=e,this.#N=r??4,this.#X=t,this.#Y()):{standard:!1}}#Y(){const e=[];return this.#F(e),this.#X?{crates:e,backUp:structuredClone(e)}:{crates:e}}#W(e,t){if(e.length<=1)return e;const r=[],s=e.splice(0,1),n=[];return e.map((e=>{e[t]<=s[0][t]?r.push(e):n.push(e)})),this.#W(r,t).concat(s,this.#W(n,t))}#R(e,t){const r=e[0]+23,s=e[2]+28;let n=10*t.length+23,a=0,i=0;for(a in t)Object.entries(t[a]).map((e=>{e[1].map((e=>{e[2]>i&&(i=e[2])})),n+=i,i=0}));return[r,n,s]}#U(e,t,r){let s=e.length>5?e[3]/r[0]:e[1]/r[0],n=e.length>5?e[1]/r[2]:e[3]/r[2];return{avlX1:t[0].x1<1&&s+t[0].x1<=1,avlY1:t[0].y1<1&&n+t[0].y1<=1,avlX2:t[0].x2<1&&s+t[0].x2<=1,avlY2:t[0].y2<1&&n+t[0].y2<=1}}#D(e,t,{artX:r,artY:s},{valX:n,valY:a},i){const{size:o}=i[0],c=i[t[1].prev],l=c&&c[1].axioX.includes(e)?c[0][1]:0,u=c&&c[1].axioY.includes(e)?c[0][3]:0;return{checkX2:t[1].x2<1&&s+a+l<=o[2],checkY2:t[1].y2<1&&r+n+u<=o[0]}}#_(e,t,r,s,n){const{size:a}=s[0],i=new WeakSet,o=+(e.valX/r.artX+t[1].x2).toFixed(2),c=+(e.valY/r.artY+t[1].y2).toFixed(2),l=+((a[0]-r.artX)/a[0]).toFixed(2),u=+((a[2]-r.artY)/a[2]).toFixed(2),h=this.#D(n,t,r,e,s);let d,p;return d=!!h.checkX2&&(t[1].x2<1&&o<=1+l||r.artX*t[1].x2+e.valX<=a[0]),p=!!h.checkY2&&(t[1].y2<1&&c<=1+u||r.artY*t[1].y2+e.valY<=a[2]),i.add(h),{x:d,y:p}}#$(e,t,r,s,n,a){const i=!r.avlX1&&r.avlY1&&r.avlY2,o=!r.avlY1&&r.avlX1&&r.avlX2,c=this.#_(e,t,s,n,t[0][0]);return o||c.y?(t[1].y2=+(e.valY/s.artY+t[1].y2).toFixed(2),t[1].axioY.push(a)):(i||c.x||r.avlX2&&r.avlY2)&&(t[1].x2=+(e.valX/s.artX+t[1].x2).toFixed(2),t[1].axioX.push(a)),t}#j(e,t,r,s){const{x2:n,y2:a}=s[1],i=n>0?n*e.closeX:e.closeX,o=a>0?a*e.closeY:e.closeY;return{X:t.refY+o<=r[0],Y:t.refX+i<=r[2]}}#q(e,t,r,s,n){const{size:a}=r[0],{length:i}=t[0],{axioX:o,axioY:c}=r[s][1],l=r[s][0].length>5?r[s][0][3]:r[s][0][1],u=r[s][0].length>5?r[s][0][1]:r[s][0][3],h=i>5?t[0][3]:t[0][1],d=i>5?t[0][1]:t[0][3],p=this.#j({closeX:h,closeY:d},{refX:l,refY:u},a,t),m=+(l*r[s][1].x2).toFixed(4),g=+(u*r[s][1].y2).toFixed(4),y=!!p.X&&m+e.valX<=a[0],f=!!p.Y&&g+e.valY<=a[2],x=e.valX/h+t[1].x2<=1,v=e.valY/d+t[1].y2<=1;return f&&x&&o.includes(t[0][0])?e.valX/r[0].size[0]<=r[0].x1&&t[1].x2<1&&(t[1].x2+=+(e.valX/h).toFixed(2),t[1].axioX.push(n),t[1].x2>1&&(t[1].x2=1)):y&&v&&c.includes(t[0][0])?e.valY/r[0].size[2]<=r[0].y1&&t[1].y2<1&&(t[1].y2+=+(e.valY/d).toFixed(2),t[1].axioY.push(n),t[1].y2>1&&(t[1].y2=1)):y&&v&&c.includes(t[0][0])&&e.valY/r[0].size[2]<=r[0].y1&&t[1].y2<1&&(t[1].y2+=+(e.valY/d).toFixed(2),t[1].axioY.push(n),t[1].y2>1&&(t[1].y2=1)),r}#J(e,t,r,s){const n=this.#U(e,t,r),a=e[0];return t.map((r=>{if(!Array.isArray(r))return;const i=r[0].length>5?r[0][3]:r[0][1],o=r[0].length>5?r[0][1]:r[0][3],c=e.length>5?e[3]:e[1],l=e.length>5?e[1]:e[3];r[0][0]===t[s][0][0]?this.#$({valX:c,valY:l},t[s],n,{artX:i,artY:o},t,a):this.#q({valX:c,valY:l},r,t,s,a)})),t}#M(e,t,r,s,n){const{size:a}=e[0],i=t.length>5?t[3]:t[1],o=t.length>5?t[1]:t[3];if(n){const{axioX:c,axioY:l}=e[n][1],u=c.includes(t[0]),h=l.includes(t[0]),d=e[n][0].length>5?e[n][0][3]:e[n][0][1],p=e[n][0].length>5?e[n][0][1]:e[n][0][3],m=i+d===a[0],g=o+p===a[2],y=e[0].x2,f=e[0].y2,x=h&&e[0].x1+r<=1,v=u&&e[0].y1+s<=1;x&&(e[0].x1=+(e[0].x1+r).toFixed(4)),v&&(e[0].y1=+(e[0].y1+s).toFixed(4)),m&&e[0].x1<1&&!v&&(e[0].x1=1),g&&e[0].y1<1&&!x&&(e[0].y1=1),(!v&&m||1===e[0].x1&&y<1&&!v)&&(e[0].y2=e[0].y2+s),(!x&&g||1===e[0].y1&&f<1&&1===y)&&(e[0].x2=e[0].x2+r)}else e[0].x1=r,e[0].y1=s,e[0].x2=e[0].y1<1?0:r,e[0].y2=e[0].x1<1?0:s;return e}#H(e,t,{size:r},s){const n=e.length>5?+(e[3]/r[0]).toFixed(4):+(e[1]/r[0]).toFixed(4),a=e.length>5?+(e[1]/r[2]).toFixed(4):+(e[3]/r[2]).toFixed(4),i=e.length>5?e[3]:e[1],o=e.length>5?e[1]:e[3];let c,l;if(t.length>1)if(this.#J(e,t,r,s),s){const{axioX:n,axioY:a}=t[s][1],u=t[s][0].length>5?t[s][0][3]:t[s][0][1],h=t[s][0].length>5?t[s][0][1]:t[s][0][3],d=n.includes(e[0]),p=a.includes(e[0]);c=d&&i+u===r[0]?1:0,l=p&&o+h===r[2]?1:0}else l=n+t[0].x1===1?1:0,c=a+t[0].y1===1?1:0;else l=n+t[0].x2===1?1:0,c=a+t[0].y2===1?1:0;return this.#M(t,e,n,a,s),t.push([e,{axioX:[],axioY:[],x1:1,y1:1,x2:c,y2:l,prev:s}]),t}#G(e,t,{size:r}){let s,n,a=e[1],i=e[3],o=t.length,c=0;for(;o-- >=0;){if(s=a/r[0]<=1&&i/r[2]<=1,n=a/r[0]<=1&&i/r[2]<=1,s||n)return e.length>=6&&e.pop(),1===c&&5===e.length&&e.push('<i class="nf nf-oct-sync"></i>'),this.#H(e,t,t[0]);[a,i]=[i,a],c=1}return t}#V(e,t){let r=0,s=0,n=t;return[...e].reverse().map((e=>{if(!Array.isArray(e))return;const{axioX:t,axioY:a}=e[1];(t.includes(n)||a.includes(n))&&(r+=a.includes(n)?e[0][1]:0,s+=t.includes(n)?e[0][3]:0)})),{sumX:r,sumY:s}}#Z(e,t,r){const s=e[t][0].length>5,n=s?+(e[t][0][3]/e[r][0][1]).toFixed(3):+(e[t][0][1]/e[r][0][1]).toFixed(3),a=s?+(e[t][0][1]/e[r][0][3]).toFixed(3):+(e[t][0][3]/e[r][0][3]).toFixed(3);return{propX:n,propY:a,spaceX:s?+(n*e[t][0][3]).toFixed(3):+(n*e[t][0][1]).toFixed(3),spaceY:s?+(a*e[t][0][1]).toFixed(3):+(a*e[t][0][3]).toFixed(3)}}#K({axioX:e,axioY:t},r,s){const{size:n}=s[0],{x2:a,y2:i}=r[1];let o,c=r[0].length>5?r[0][3]:r[0][1],l=r[0].length>5?r[0][1]:r[0][3];if(e.includes(r[0][0]))for(o of e){if(o===r[0][0])break;s.map(((e,t)=>{t>0&&e[0][0]===o&&(c+=e[0].length>5?e[0][3]:e[0][1])}),0)}else for(o of t){if(o===r[0][0])break;s.map(((e,t)=>{t>0&&e[0][0]===o&&(l+=e[0].length>5?e[0][1]:e[0][3])}),0)}return c=e.includes(r[0][0])&&i<1?n[0]-c:0,l=t.includes(r[0][0])&&a<1?n[2]-l:0,{valX:c,valY:l}}#Q(e,t,r){const{x1:s,y1:n,size:a}=e[0],{axioX:i,axioY:o,x2:c,y2:l}=e[t][1],u=this.#K({axioX:i,axioY:o},e[r],e),h=this.#Z(e,r,t),d=l<h.propY?u.valX:+(a[0]-e[0].x1*a[0]).toFixed(4),p=c<h.propX?u.valY:+(a[2]-e[0].y1*a[2]).toFixed(4);return{gapX1:0===e[r][1].y2?d:1===s&&e[0].y2<1?a[0]-h.spaceX:0,gapY1:0===e[r][1].x2?p:1===n&&e[0].x2<1?a[2]-h.spaceY:0}}#ee(e,t,r,s){const n=this.#K(e[s][1],r,e,s),a=this.#Z(e,t,s),i=new WeakSet,{size:o}=e[0],{x2:c,y2:l,axioY:u}=e[s][1],h=this.#V(e,r[0]),d=this.#Q(e,s,t),p=e[s][0][1]-+(c*e[s][0][1]).toFixed(4),m=e[s][0][3]-+(l*e[s][0][3]).toFixed(4),g=r[1].x2<1&&o[2]>a.spaceY&&u.includes(r[0][0]);let y,f,x=d.gapX1,v=d.gapY1;return 1===r[1].x2&&1===r[1].y2?(y=0,f=0):r[1].x2<1?(y=0===r[1].y2&&l<=1?o[0]-(p+d.gapX1):r[1].y2<1?n.valX:0,f=g&&c<=1?d.gapX1:0):(f=x>0&&r[1].y2<1?c<=1?o[2]-(m+r[0][3]):o[2]-(l*e[s][0][3]+h.sumX):0,y=0===d.extraX?o[0]-(h.sumX+e[s][0][1]):d.gapX1),i.add(h),i.add(d),i.add(n),{gapX1:x,gapX2:y,gapY1:v,gapY2:f}}#te(e){return{X:e.length>5?e[3]:e[1],Y:e.length>5?e[1]:e[3]}}#re(e){const{x1:t,y1:r,size:s}=e[0],{x2:n,y2:a}=e[1][1];let i,o,c,l;const u=this.#te(e[1][0]);return i=n<1&&1===a&&1===r&&e[0].y2<=1?s[0]-s[0]*e[0].x2:1===t?+((1-t)*s[0]).toFixed(4):a<1?s[0]-u.X:0,o=n<1&&a<1?s[2]-u.Y:+((1-r)*s[2]).toFixed(4),n<1||t<1?(c=a<=1?+(s[0]-n*u.X).toFixed(4):s[0]-s[0]*e[0].x2,l=n<=1&&a<=1?+(s[2]-u.Y+(1-a)*u.Y).toFixed(4):s[2]*(1-e[0].y2)):(a<1||r<1)&&(l=n>1?u.Y-a*u.Y:a<=1?+(s[2]*(1-e[0].y2)).toFixed(4):+(s[2]-(1-a)*u.Y).toFixed(4),c=t<1?+(s[0]*(1-t)).toFixed(4):s[0]-u.Y,0===i&&(i=c)),{gapX1:i,gapX2:c,gapY1:o,gapY2:l}}#se(e,t){const{prev:r}=e[t][1];return!0===Number.isSafeInteger(r)?this.#ee(e,t,e[t],r):this.#re(e)}#ne(e,t,r,s){const n=this.#se(e,r),a=n.gapY1>0&&n.gapY1>=t.sizeY,i=n.gapX2>0&&n.gapX2>=t.sizeX,o=n.gapX1>0&&n.gapX1>=t.sizeX,c=n.gapY2>0&&n.gapY2>=t.sizeY;return(a&&i||o&&c)&&(s.loop=!1,s.value=r),s}#ae(e,t,r){let s,n=e[1],a=e[3];const{size:i}=r[0];return 1===t?([n,a]=[a,n],n=+(n/i[0]).toFixed(4),a=+(a/i[2]).toFixed(4),s={x:n,y:a,sizeX:e[3],sizeY:e[1]}):(n=+(n/i[0]).toFixed(4),a=+(a/i[2]).toFixed(4),s={x:n,y:a,sizeX:e[1],sizeY:e[3]}),s}#ie(e,t,r){let s={loop:!0,value:!1},n=0;const a=new WeakSet,i=this.#ae(e,r,t);for(;++n<t.length&&s.loop;)this.#ne(t,i,n,s);return a.add(s),s.value}#oe(e,t){let r,s=!0,n=0;if(1===t.length)return this.#G(e,t,t[0]);for(;s;){if(r=this.#ie(e,t,n),r)return e.length>=6&&e.splice(5,1),1===n&&5===e.length&&e.push('<i class="nf nf-oct-sync"></i>'),this.#H(e,t,t[0],r);1===n&&(s=!1),n=0===n?1:0}return t}#ce(e,t,r){const{x1:s,y1:n,x2:a,y2:i}=t[0];if(!(1===s&&1===n&&1===a&&1===i||r<0))return this.#oe(this.#a[r],t,t[0]),this.#ce(e,t,r-1);t.map(((t,r)=>r>0?e.push(t[0]):0),0)}#le(e,t){switch(this){case 1:e.unshift({layer1:t});break;case 2:e.push({layer2:t});break;case 3:e.push({layer3:t});break;case 4:e.push({layer4:t});break;case 5:e.push({layer5:t});break;default:return}}#ue(e,t){let r=0;const s=[],n=this.#a.at(-1);return n[1]===t[0]&&n[3]===t[2]?(r++,this.#le.call(r,e,[n]),this.#a.pop()):(this.#a.reverse().map((e=>{e[1]===t[0]&&s.push(e)})),s.map((t=>{r++,this.#le.call(r,e,[t]),this.#a.splice(this.#a.indexOf(t),1)}))),r}#he(e){const t=new WeakSet;let r,s,n=[],a=[],i=!0,o=this.#ue(n,e);for(;o++<this.#N||i&&this.#a.length;)s={size:e,x1:0,y1:0,x2:0,y2:0},r=this.#a.length-1,this.#ce(a,[s],r),a.length>0&&(a.map((e=>this.#a.splice(this.#a.indexOf(e),1))),this.#le.call(o,n,a),t.add(s),a=null,a=[]),i=1===this.#a.length&&o===this.#N;return n}#de(e){const t=e.at(-1),r=e.filter((e=>{if(t[4]>=e[4])return e}));return this.#a.length===r.length}#pe(e){const t=this.#de(e);let r=e.length,s=0,n=0,a=0;if(t)return[e.at(-1)[1],e.at(-1)[2],e.at(-1)[3]];for(;r--;)s+s+e[r][1]<=250?s+=e[r][1]:(s<e[r][1]&&e[r][1]<=250||e[r][1]>250)&&(s=e[r][1]),n=e[r][2]??n,a+a+e[r][3]<=132?a+=e[r][3]:(a<e[r][3]&&e[r][3]<=132||e[r][3]>132)&&(a=e[r][3]);return[s,n,a]}#me(e){let t=e.map((e=>(e.push(e[1]*e[3]),e)));return t=this.#W(t,5),t=t.map((e=>(e.pop(),e))),this.#a=t}#F(e){if(!this.#a.length)return;this.#me(this.#a);const t=this.#pe(this.#a),r=this.#he(t),s=this.#R(t,r);return e.push(s),e.push({works:r}),this.#F(e)}}class CraterLastCheckReArranger{#ge;constructor(e){return"crates ahead"===e[0]&&(this.#ge=e,this.#ye())}#W(e,t){if(e.length<=1)return e;const r=[],s=e.splice(0,1),n=[];let a=0;for(a in e)e[a][t]<=s[0][t]?r.push(e[a]):n.push(e[a]);return this.#W(r,t).concat(s,this.#W(n,t))}#fe(e,t,r){const s=e[t],{works:n}=s;return n.map((e=>{Object.entries(e).map((e=>{1===e.length?r.push(e[1].flat()):e[1].map((e=>r.push(e)))}))})),structuredClone(r)}#xe(e,t){const r=new WeakSet,s=t.works.length;let n,a=0,i=!0;for(;a++<e.length&&i;)a%2==1&&(n=1===s?structuredClone(t.works[0]):structuredClone(t.works),this.#fe(e,a,n),n=this.#W(n,4),n=new CraterStandard(n,!1,4),2===n.crates.length&&(e.splice(a,1,n.crates[1]),e.splice(a-1,1,n.crates[0]),i=!1),r.add(n));return!i}#ve(e,t,r){return r<0?t:(r%2==1&&this.#xe(e,t[r])&&(t.splice(r-1,2),r=t.length),this.#ve(e,t,r-1))}#Ce(e){let t,r,s=0;for(r in e)if(s++%2==1&&5===e[r].works.length&&(t=e[r].works[4].layer5),t)break;return!!t&&{info:r,works:t}}#ke(e,t){let r,s=[];return Object.entries(t).map((e=>{e[1].map((e=>{let t;for(t in e)e[t].length>0&&Array.isArray(e[t])&&e[t].map((e=>s.push(e)))}))})),e.map((e=>s.push(e))),r=this.#W(s,4),r}#be(e,t,r,s){return e[s].works.pop(),e[s-1][1]-=10,e.splice(t-1,1,r.crates[0]),e.splice(t,1,r.crates[1]),e}#we(){const{crates:e}=this.#ge.standardCrate,t=this.#Ce(e);let r,s,n,a,i=0;if(t)for(a in e){if(!Array.isArray(e[a])&&i!==+t.info&&(r=this.#ke(t.works,e[a]),s=new CraterStandard(r,!1,5),n=2===s.crates.length,n)){this.#be(e,i,s,t.info);break}i++}}#ye(){const e=this.#ge.sameSizeCrate.crates,t=this.#ge.sameSizeCrate.backUp,r=this.#ge.standardCrate.crates;let s;if(e&&r){if(s=e.length,this.#ve(r,e,s),e.length===t.length)return this.#ge.sameSizeCrate.backUp=!1,void(this.#ge.standardCrate.backUp=!1);this.#we()}}}class CraterNotCanvas{#c;constructor(e){return e&&0!==e.length?(this.#c=e,this.#A()):{noCanvas:!1}}#W(e,t){if(e.length<=1)return e;const r=[],s=e.splice(0,1),n=[];return e.map((e=>{e[t]<=s[0][t]?r.push(e):n.push(e)})),this.#W(r,t).concat(s,this.#W(n,t))}#z(e){return[e[0]+23,e[1]+23,e[2]+28]}#Se(e){let t,r=0,s=0,n=0,a=0;return t=e.length/2,e.map((e=>{t-- >0&&(r+=e[1],s<e[2]&&(s=e[2])),n=e[1],a<e[2]&&(a=e[2])})),n>r||(n=r),a+=s,{newX:n,newZ:a}}#Ae(e){const t=e.length>4&&e.length%2==0;let r,s=0,n=0,a=0;return e.map((e=>{s+=e[1],n=e[2]>n?e[2]:n,a=e[3]>a?e[3]:a})),(s>277||t)&&(r=this.#Se(e),s=r.newX,n=r.newZ),this.#z([s,n,a])}#Ie(e,t){const r=e[1]===t[1]&&e[1]<277,s=e[2]===t[2]&&e[2]<177,n=e[3]<=132;return!!(r&&s&&n)}#Te(e,t,r,s){return s.length%2==0&&e>554&&2*t+10<177?s.length:0===r||s[0][1]>554?1:r}#Ee(e){let t=10*e.length,r=0,s=0;const n=e[0];return e.map((e=>{const a=this.#Ie(e,n),i=e[2]-n[2],o=n[2]-e[2];(!0===a||(i>0&&i<=10||o>0&&o<=10))&&(s++,t+=e[1],r+=e[3])})),this.#Te(t,r,s,e)}#ze(e){if(!Array.isArray(e))return e;let t=e.map((e=>(e.push(e[1]*e[2]),e)));return t=this.#W(t,5),t=t.map((e=>(e.pop(),e))),this.#c=t}#A(){const e=[];let t;for(this.#ze(this.#c);this.#c.length>0;)t=this.#Ee(this.#c),t=this.#c.splice(0,t),t.length>0?(e.push(this.#Ae(t)),e.push({works:t})):(e.push(this.#Ae(this.#c.splice(0,1))),e.push({works:t}));return{crates:e}}}class CraterSameSize{#c;constructor(e){return e&&0!==e.length?(this.#c=e,this.#Oe()):{sameSize:!1}}#Pe(e){return[e[0]+23,e[1]+23,e[2]+28]}#Be(e,t,r){const s=e.map((e=>{const s=e[0]+t[0]<=r[0],n=e[1]+t[1]<=r[1],a=e[2]+t[2]<=r[2];if(s&&n&&a)return e}));return void 0!==s[0]&&s.map((t=>e.splice(e.indexOf(t),1))),void 0!==s[0]}#Le(e,t){let r=[];return void 0!==t.map((t=>{const s=t[0]===e[0][0],n=t[2]===e[0][2],a=t[0]===e[0][0]-10,i=t[2]===e[0][2]-10;if(s&&n||a&&i)return t;if(r.length>0){if(this.#Be(r,t,e))return t}else r.push(t)}))[0]}#Ne(e,t){const r=e.shift(),s=1===t.length?t[0].length:t.length;let n,a,i,o;return r?(n=s%2+s/2,a=e[0],i=5*n,o=e[2]):(n=s%2+s,a=e[0],i=5*n,o=e[2]),this.#Pe([a,i,o],r)}#Xe(e,t){const r=t.length>3?[t[0][1],t[0][2],t[0][3]]:t;let s=e[0],n=e[1],a=e[2]+r[2],i=!1;return a>132&&s<132?([a,s]=[s,a],i=!0):a>e[2]&&(i=!0),[i,[s,n,a]]}#Ye(e){let t,r=e.splice(0,1).flat(),s=e.splice(0,1).flat();return e.length>0&&(t=this.#Le(r,e)),t?(r=this.#Xe(r,e.splice(0,1)),e[0].map((e=>s[0][0].push(e))),e.splice(0,e[0].length)):s[0].length>10&&s[0].length%2==0?r=this.#Xe(r,s[0]):r.unshift(!1),Array.isArray(s[0][0])&&(s=s.flat()),{crate:this.#Ne(r.flat(),s),works:s}}#Fe(e){const t=[];let r;for(;e.length;)r=this.#Ye(e),t.push(r.crate),t.push({works:r.works});return t}#We(){let e=this.#c[0][1],t=this.#c[0][2],r=this.#c[0][3],s=[[e,t,r]],n=[];return this.#c.map((a=>{a[2]<=10&&(a[1]!==e&&a[3]!==r&&(s.push([n]),e=a[1],t=a[2],r=a[3],s.push([e,t,r]),n=[]),n.push(a))})),s.push(n),s[1][0].length>=4?s:null}#Oe(){let e=this.#We();if(null===e)return null;const t=this.#Fe(e);return e=null,{crates:t,backUp:JSON.parse(JSON.stringify(t))}}}class CraterTube{#Re;constructor(e){return e&&0!==e.length?(this.#Re=e,this.#Ue()):{tube:!1}}#Ue(){return this.#De(),this.#Re}#_e(){let e=this[0][1],t=this[0][2],r=0;return this.map((s=>{e=s[1]>e?s[1]:e,t=s[2]>t?s[2]:t,r+=s[3]})),[e,t,r]}#$e(e,t){return[this[0]+e,this[1]+e,this[2]+t]}#je(){return[this[0][1]+18,this[0][2]+18,this[0][3]+25]}#qe(e){const t=this.#_e.call(e);return this.#$e.call(t,18,25)}#Je(e,t){switch(e){case 1:return this.#je.call(t);case 2:case 3:case 4:return this.#qe(t)}}#Me(e){const t=[];let r;for(;e.length>=3;)r=e.splice(0,3),t.push(this.#Je(r.length,r)),t.push({works:r});return t}#He(){const e=this.#Re.filter((e=>{if(e[2]>35)return e}));return e.map((e=>{this.#Re.splice(this.#Re.indexOf(e),1)})),e}#De(){let e=[],t=[];const r=this.#He();for((r.length>0||r.length>3)&&t.push(this.#Me(r));this.#Re.length;)e=this.#Re.splice(0,3),t.push(this.#Je(e.length,e)),t.push({works:e});return this.#Re.length>=1&&(t.push(this.#Je(this.#Re.length,this.#Re)),t.push({works:this.#Re})),this.#Re={crates:t}}}class Crater{#C;#Ge;constructor(e){return e!==Arranger?{crater:!1}:(this.#C=e.list,this.#Ge=["crates ahead"],Object.assign(Crater,this.#Ve()))}#Ve(){let e=0;const t=["tubeCrate","largestCrate","sameSizeCrate","noCanvasCrate","standardCrate"];for(e in this.#qe(),this.#Ze(),this.#Ke(),this.#Qe(),this.#et(),this.#tt(),this.#Ge)this.#Ge[e]?.hasOwnProperty("crates")&&t.includes(e)||delete this.#Ge[e];return this.#rt(),this.#st(),this.#nt(),this.#at(),Array.isArray(this.#Ge?.sameSizeCrate?.backUp)&&(this.#it(),this.#ot(),this.#ct()),{crates:this.#Ge}}#qe(){const e=new CraterTube(this.#C?.tubes);this.#Ge.tubeCrate=e}#Ze(){const e=new CraterPythagoras(this.#C?.largest);this.#Ge.largestCrate=e}#Ke(){const e=new CraterSameSize(this.#C?.sameSize);this.#Ge.sameSizeCrate=e}#Qe(){const e=new CraterNotCanvas(this.#C?.noCanvas);this.#Ge.noCanvasCrate=e}#et(){const e=this.#Ge.sameSizeCrate.hasOwnProperty("crates"),t=new CraterStandard(this.#C?.sorted,e);this.#Ge.standardCrate=t}#tt(){new CraterLastCheckReArranger(this.#Ge)}#rt(){let e=0;const t=[],r=e=>{Array.isArray(e)&&t.push(e)};for(e in this.#Ge)this.#Ge[e]?.crates?.map(r);this.#Ge.allCrates=t}#ct(){let e,t,r=0;const s=[],n=e=>{Array.isArray(e)&&s.push(e)};for(r in this.#Ge)e="sameSizeCrate"===this.#Ge[r],t="standardCrate"===this.#Ge[r],(e||t)&&this.#Ge[r]?.backUp?.map(n),this.#Ge[r]?.crates?.map(n);this.#Ge.allCratesBackUp=s}#st(){let e=0;const t=e=>{if(Array.isArray(e)&&3===e.length){const t=e[0],r=e[1],s=e[2],n=new CubCalc(t,r,s).cubCalcAir;e.push(n)}};for(e in this.#Ge)this.#Ge[e]?.crates?.map(t);Array.isArray(this.#Ge?.sameSizeCrate?.backUp)&&(this.#Ge?.sameSizeCrate?.backUp?.map(t),this.#Ge?.standardCrate?.backUp?.map(t))}#nt(){let e=0,t=[];const r=e=>{Array.isArray(e)&&t.push(e[3])};for(e in this.#Ge)this.#Ge[e]?.crates?.map(r);t=t.reduce(((e,t)=>+(e+t).toFixed(3)),0),this.#Ge.airCubTotal=t}#it(){let e,t,r=[],s=0;const n=e=>{Array.isArray(e)&&r.push(e[3])};for(s in this.#Ge)e="sameSizeCrate"===this.#Ge[s],t="standardCrate"===this.#Ge[s],e||t?this.#Ge[s]?.backUp?.map(n):e||t||this.#Ge[s]?.crates?.map(n);r=r.reduce(((e,t)=>+(e+t).toFixed(3)),0),this.#Ge.airCubTotalBackUp=r}#lt(e){if(Array.isArray(e)){const t=e[0],r=e[1],s=e[2];return t>300||r>200||s>160?"CARGO":"PAX"}}#at(){let e,t=0,r=0,s=0;for(s in this.#Ge)this.#Ge[s]?.crates?.map((s=>{e=this.#lt(s),"PAX"===e?t++:"CARGO"===e&&r++}));this.#Ge.whichAirPort=[{PAX:t},{CARGO:r}]}#ot(){let e,t,r,s=0,n=0,a=0;for(s in this.#Ge)e="sameSizeCrate"===this.#Ge[s],t="standardCrate"===this.#Ge[s],e||t?this.#Ge[s]?.backUp?.map((e=>{r=this.#lt(e),"PAX"===r?n++:"CARGO"===r&&a++})):e||t||this.#Ge[s]?.crates?.map((e=>{r=this.#lt(e),"PAX"===r?n++:"CARGO"===r&&a++}));this.#Ge.whichAirPortBackUp=[{PAX:n},{CARGO:a}]}}class UnitAdapter{#a;#ut;constructor(e,t){return this.#a=e,this.#ut=t,this.#ht()}#dt(){try{if(!Array.isArray(this.#a)){throw new TypeError("Please, provide a valid list.")}if(this.#a.some((e=>"ArtWork"!==e.constructor.name))){throw new TypeError("Please, provide a type of 'ArtWork' object list.")}if("cm"!==this.#ut&&"in"!==this.#ut){throw new TypeError("Please, provide a valid unit.")}}catch(e){return e}return"pass"}async#ht(){let e;const t=this.#dt();switch("pass"!==t?"error":"cm"===this.#ut?"cm":"in"){case"error":return t;case"cm":return e=await this.#pt(),e;case"in":return e=await this.#mt(),e}}#gt(e){const t=e?.hasOwnProperty("crates"),r=e?.hasOwnProperty("backUp");return Array.isArray(e)?e.map(n):e?.hasOwnProperty("crates")?((t||r)&&(e.crates=e.crates.map((e=>4===e.length?n(e):(Array.isArray(e.works[0])?e.works=e.works.map(n):e.works=e.works.map(a),e)))),e):e}#yt(){return this.#a.map((e=>{const t=e.autoConvert,r=t[0],s=t[1],n=t[2],a=t[3];return new ArtWork(r,s,n,a)}))}#ft(e){let t=0;for(t in e)e[t].hasOwnProperty("crates")&&(e[t]=this.#gt(e[t]));return e.sameSizeCrate?.hasOwnProperty("backUp")&&(e.airCubTotalBackUp=+(.061023*e.airCubTotalBackUp).toFixed(3),e.allCratesBackUp=this.#gt(e.allCratesBackUp)),e.allCrates=this.#gt(e.allCrates),e}async#pt(){return await Promise.resolve(new Arranger(this.#a)).then((e=>new Crater(e))).then((e=>e.crates)).catch((e=>e))}async#mt(){return await Promise.resolve(this.#yt()).then((e=>new Arranger(e))).then((e=>new Crater(e))).then((e=>this.#ft(e.crates))).catch((e=>e))}}function n(e){const t=.061023;let r,s,n,a;switch(e.length){case 4:return s=e[0],n=e[1],a=e[2],r=Array.from(new Converter(s,n,a).inConvert),r.push(+(e[3]*t).toFixed(3)),r;case 5:return s=e[1],n=e[2],a=e[3],r=Array.from(new Converter(s,n,a).inConvert),r.unshift(e[0]),r.push(+(e[3]*t).toFixed(3)),r}}function a(e){let t=0;for(t in e)1===e[t].length?e[t]=[n(e[t][0])]:e[t]=e[t].map(n);return e}function i(e,t,r,s){switch(e){case 409:!async function(e,t,r){if(confirm("This estimate already exist. Would you like to update it?")){const s="/update/estimate";try{const n=await fetch(s,{method:"PUT",body:e,headers:t}).then((e=>e.status)).catch((e=>console.error(`ALERT ${e}`)));403===n&&i(n,r)}catch(e){alert(`ATTENTION: ${e}`)}}else alert("Not updated!")}(r,s,t);break;case 403:!async function(e){const t={"Content-Type":"application/json; charset=UTF-8"};try{await fetch("/shift/tokens",{method:"POST",headers:t}).then((e=>e.status)).catch((e=>console.error(`ALERT ${e}`))),o(e)}catch(e){alert(`ATTENTION: ${e}`)}}(t)}}async function o(e){const t=JSON.stringify(e),r={"Content-Type":"application/json; charset=UTF-8"};if(globalThis.navigator.onLine)try{i(await fetch("/new/estimate/",{method:"POST",body:t,headers:r}).then((e=>e.status)).catch((e=>console.error(`ALERT ${e}`))),e,t,r)}catch(e){alert(`ATTENTION: ${e}`)}else!function(e){const t=localStorage,r=t.getItem("offResults"),s=void 0!==r&&JSON.parse(r);s?(s.push(e),t.removeItem("offResults"),t.setItem("offResults",JSON.stringify(s))):t.setItem("offResults",JSON.stringify([e]))}(e.reference)}async function c(e){const t=await async function(e){const t=new Worker(new URL("./panels/worker.IDB.crates.mjs",import.meta.url),{type:"module"});let r;return t.postMessage(e),r=await new Promise(((r,s)=>{t.onmessage=t=>{const{data:n}=t;n.reference===e?r(n):s(t)}})),r}(e),{reference:r,list:s,crates:n}=t,a={reference:r,list:s,crates:Object.assign({},n)};await o(a)}function l(){const e="Results",t=globalThis.indexedDB.open(e);t.onerror=e=>{alert(`ATTENTION! ${e.target.errorCode}`)},t.onupgradeneeded=t=>{let r;r=t.target.result.createObjectStore(e,{keyPath:"reference"}),r.createIndex("reference","reference",{unique:!0})}}function u(e,t=!1){const r=localStorage.getItem("refNumb"),s="Results",n=globalThis.indexedDB.open(s),a=globalThis.navigator.onLine;n.onerror=e=>{alert(`ERROR: ${e.target.errorCode}`)},n.onsuccess=async n=>{const i=n.target.result.transaction(s,"readwrite").objectStore(s),o=i.get(e.reference);o.onsuccess=async()=>{void 0===o.result?i.add(e):await Promise.resolve(i.delete(o.result.reference)).then(i.add(e)),h(r,t)},a||function(e,t){const r="off_line_results",s=document.getElementById("input_estimate").value,n=globalThis.indexedDB.open(r);n.onerror=e=>{alert(`ERROR: ${e.target.errorCode}`)},n.onsuccess=async n=>{const a=n.target.result.transaction(r,"readwrite").objectStore(r),i=a.get(e.reference);i.onsuccess=()=>{(void 0===i.result||a.delete(i.result.reference))&&a.add(e),h(s,t)}}}(e)}}async function h(e,t=!1){const r=globalThis.indexedDB.open("Results");r.onerror=e=>{alert(`WARNING: ${e.target.errorCode}`)},r.onsuccess=()=>{const s=r.result.transaction("Results").objectStore("Results").get(e);s.onsuccess=async()=>{const e=localStorage.getItem("refNumb"),r=s.result;globalThis.sessionStorage.setItem(e,JSON.stringify(r)),t?sessionStorage.setItem("pane1","populate"):await c(e)}}}async function d(){const e=await f();let t=document.getElementById("count");return t.innerText=e?"Counting: "+e?.length:"Counting 0",t}async function p(){let e;const t=document.getElementById("cub-meter");return e=await f(),e=e?.reduce(((e,t)=>e+t.cubed),0)??0,t.innerText="Cub: "+(1e3*e/1e3).toFixed(3)+"m³",t}async function m(){let e,t,r;return r="Air-Cub: ",t=document.getElementById("cub-air"),e=await f(),e=e?.reduce(((e,t)=>e+t.cAir),0)??0,t.innerText="Air-Cub: "+(1e3*e/1e3).toFixed(3),t}async function g(e=!1){const t=await async function(){const e="cm - centimeters"===localStorage.getItem("metrica")?"cm":"in",t=await f();let r;return t?(r=await Promise.resolve(new UnitAdapter(t,e)),r):alert("Oops! Sounds like you do not added any work yet. Please, try again!")}(),r={},s=document.createElement("padding-dialog"),n=new WeakSet,a=new DocumentFragment,i=localStorage.getItem("refNumb")??document.getElementById("input_estimate").value;let o;return(e||confirm("Ready to crate all works?")&&t)&&(r.reference=i,o=await f(),r.list=o.map((e=>e.data)),r.crates=t,u(r,e),sessionStorage.setItem("pane1","populate"),setTimeout((()=>{const e=document.querySelector(".side-menu");e?.getElementsByTagName("padding-dialog")?.length>0&&sessionStorage.setItem("CLOSED","NOW"),a.appendChild(s),document.querySelector(".side-menu").appendChild(a)}),150)),n.add(r),"Crated"}function y(e=!1){document.getElementById("input_code").value="",document.getElementById("input_estimate").select(),document.getElementById("input_length").value="",document.getElementById("input_depth").value="",document.getElementById("input_height").value="",d(),p(),m(),!e||sessionStorage.setItem("pane1","clear")}async function f(){const e=localStorage,t=[];let r;const s=["doneList","mode","storage","currency","currency","metrica","refNumb","offResults","FETCHED"];return Object.entries(e).map((e=>{!s.includes(e[0])&&t.push(JSON.parse(e[1]))})),t.length>0&&(r=t.map((e=>new ArtWork(e.code,e.x,e.z,e.y)))),r||void 0}function x(e){const t=function(e){let t=2;const r=/^[0-9\.0-9]{1,7}$/;for(;--t>=0;)if(!r.test(e[t]))switch(t){case 2:return alert("The provide HEIGHT is not a valid number.\t\t\t\t\tPlease, try again!"),!1;case 1:return alert("The provide DEPTH is not a valid number.\t\t\t\t\tPlease, try again!"),!1;case 0:return alert("The provide LENGTH is not a valid number.\t\t\t\t\tPlease, try again!"),!1}return e}([e[1],e[2],e[3]].map((e=>parseInt(e))));const r=/[^-a-z-A-Z-0-9]/g,s=document.getElementById("input_estimate").value;let n;for(n in n=0,localStorage.key(n))if(e[0]===localStorage.key(n))return alert(`${e[0]} already added to the list. Please, try again`),!1;return!0===(r.test(e[0])||r.test(s))?(alert('Found special character NOT allowed on "Work code",\t\t\tor "Estimate" input. Please, try again!'),!1):(function(){const e=localStorage.getItem("refNumb"),t=document.getElementById("input_estimate").value;e&&e!==t&&(confirm("ATTENTION! The refNumb has changed")?(localStorage.removeItem("refNumb"),localStorage.setItem("refNumb",t),document.getElementById("input_estimate").value=t):document.getElementById("input_estimate").value=e);localStorage.setItem("refNumb",t)}(),!!Array.isArray(t)&&new ArtWork(e[0],t[0],t[1],t[2]))}function v(){const e=document.getElementById("input_estimate").value,t=document.getElementById("input_code").value,r=document.getElementById("input_length").value,s=document.getElementById("input_depth").value,n=document.getElementById("input_height").value;let a;return e?""===(t&&r&&s&&n)?(alert("Oops! Do not forget to fill each field. Please, try again!"),y()):(a=x([t,r,s,n]),!1!==a&&(!function({code:e}){const t=sessionStorage,r=JSON.parse(t.getItem("codes"));let s;r?(s=Number.parseInt(r[r.length-1]),s+=1,r.push([s,e]),t.setItem("codes",JSON.stringify(r))):t.setItem("codes",JSON.stringify([[0,e]]))}(a.data),localStorage.setItem(a.data.code,JSON.stringify(a.data)),localStorage.setItem("storage","art-work"),d(),m(),p()),y()):alert('Attention! Please, add the "Doc:" reference field!')}function C(){const e=prompt("Please enter the work code to be removed:","code?");if(localStorage.getItem(e))!function(e){const t=sessionStorage,r=JSON.parse(t.getItem("codes"));let s=0;for(;r[s][1]!==e&&s<=r.length;)s++;r.splice(s,1),t.setItem("codes",JSON.stringify(r))}(e),localStorage.removeItem(e),d(),m(),p();else{if(null===e)return y();alert(`"${e}" was not found in the list. Please, try again!`)}return localStorage.setItem("storage","art-work"),y()}function k(e){const t=document.createDocumentFragment();return e.map((e=>{const r=document.createElement("option");r.textContent=e,t.appendChild(r)})),t}function b(e,t,r,s){const n=JSON.parse(sessionStorage.getItem("currency")),a=1e3,i=Number.parseFloat(r.value)===n[e],o=Number.parseFloat(s.value)===n[t];return e===t?i?s.value:r.value:i&&o?~~(n[e]*n[t]*a)/a:n[e]<n[t]?!0===i?~~(s.value/n[t]*n[e]*a)/a:~~(r.value*n[t]/n[e]*a)/a:!0===o?~~(r.value*n[t]/n[e]*a)/a:~~(s.value/n[t]*n[e]*a)/a}async function w(){const e=await fetch("/currency",{method:"GET",headers:{"Content-Type":"application/json; charset=UTF-8"}}).then((e=>e.json())).catch((e=>alert(`CurrencyError: ${e}!`))),{rates:t}=e.response,r=globalThis.sessionStorage;return t&&r.setItem("currency",JSON.stringify(t))}function S(e,t){const r=JSON.parse(sessionStorage.getItem("currency"));if(!r)return!1;t.value=r[e]}async function A(){await w(),await async function(){const e=JSON.parse(sessionStorage.getItem("currency")),t=document.getElementById("coin1"),r=document.getElementById("coin2"),s=Object.keys(e);if(!e)return"Error";t.appendChild(k(s)),r.appendChild(k(s))}()}function I(e,t,r,s){return"centimeters"===e?function(e,t,r,s){const n=2.54,a=.01,i=T(e,t);if(e===t)return r.value>s.value?r.value:s.value;if(i.checked1)return E(r,s,n,"in");return E(r,s,a,"m")}(e,t,r,s):"inches"===e?function(e,t,r,s){const n=.393,a=.0254,i=T(e,t);if(e===t)return r.value>s.value?r.value:s.value;if(i.checked2)return E(r,s,n,"cm");return E(r,s,a,"m")}(e,t,r,s):function(e,t,r,s){const n=.01,a=.0254,i=T(e,t);if(e===t)return r.value>s.value?r.value:s.value;if(i.checked3)return E(r,s,n,"cm");return E(r,s,a,"in")}(e,t,r,s)}function T(e,t){return{checked1:"centimeters"===e&&"inches"===t,checked2:"inches"===e&&"centimeters"===t,checked3:"meters"===e&&"centimeters"===t}}function E(e,t,r,s){const n=1e3;return"m"!==s?e.value>t.value?~~(e.value/r*n)/n:~~(t.value*r*n)/n:e.value<t.value?~~(t.value/r*n)/n:~~(e.value*r*n)/n}function z(e,t,r){return+(e/r*t).toFixed(0)}function O(e,t){return e>=1024?function(e){const t=800;let r,s;e[0]>e[1]?(r=t,s=+(e[1]/e[0]*t).toFixed(0)):(s=t,r=+(e[0]/e[1]*t).toFixed(0));return{x:r,y:s}}(t):function(e){const t=.87,r=globalThis.screen.availWidth*t,s=globalThis.screen.availHeight*t;let n,a;e[0]>e[1]?(n=r,a=+(e[1]/e[0]*s).toFixed(0)):(a=s,n=+(e[0]/e[1]*r).toFixed(0));return{x:n,y:a}}(t)}globalThis.onstorage=()=>{p(),m(),d()};class TubeRender{#xt;#Re;#vt;constructor({works:e},t,r){return this.#xt=t,this.#vt=[r[0]+5,r[1],r[2]+3],this.#Re=Array.isArray(e[0])?e:[e],this.#Ct()}#kt({x:e,y:t}){const r=document.createElementNS("http://www.w3.org/2000/svg","rect"),s=t.length>1?P(t):0;return r.setAttribute("x",1),r.setAttribute("y",s+1),r.setAttribute("width",e.at(-1)-20),r.setAttribute("height",t.at(-1)-20),r}#bt({x:e,y:t},r){const s=document.createElementNS("http://www.w3.org/2000/svg","text"),n=e.at(-1),a=.5*t.at(-1),i=.5*n-10*r.length*.5,o=1===t.length?a:P(t)+a;return s.setAttribute("x",i),s.setAttribute("y",o),s.innerHTML=r[0],s}#Ct(){let e;const t=document.createDocumentFragment(),r=[],s=[],n="cm - centimeters"===localStorage.getItem("metrica")?"cm":"in";return this.#Re.map((a=>{if("in"===n){const e=a[0];(a=new Converter(a[1],a[2],a[3]).cmConvert).unshift(e)}r.push(z(a[1],this.#xt.x,this.#vt[0])),s.push(z(a[3],this.#xt.y,this.#vt[2])),t.appendChild(this.#kt({x:r,y:s})),e=[{x:r,y:s},a,this.#vt],t.appendChild(this.#bt.apply(null,e))})),t}}function P(e){let t;return 2===e.length?e.at(-2):(t=e.reduce(((e,t)=>e+t),0),t-e.at(-1))}class StandardRender{#wt;#St;#vt;#At;constructor({works:e},t,r,s){return this.#St=t,this.#At=JSON.parse(JSON.stringify(t)),this.#vt=r,this.#wt=Object.values(e[s])[0],this.#At.x2=this.#At.x,this.#At.y2=this.#At.y,this.#It()}#kt({pos:e,values:t}){const r=document.createElementNS("http://www.w3.org/2000/svg","rect"),s=this.#St.x,n=this.#St.y,a=.95;return r.setAttribute("x",e[0]+1),r.setAttribute("y",e[1]+1),t[0]>=s*a||e[0]+t[0]+1>=s*a?r.setAttribute("width",t[0]-20):r.setAttribute("width",t[0]),t[1]>=n*a||e[1]+t[1]>=n*a?r.setAttribute("height",t[1]-20):r.setAttribute("height",t[1]),r}#bt({pos:e,values:t},r){const s=this.#St.x,n=this.#St.y,a=document.createElementNS("http://www.w3.org/2000/svg","text"),i=.5;let o,c;return o=t[0]>=.95*s?e[0]+t[0]*i-20:e[0]+t[0]*i,c=t[0]>=.95*n?e[1]+t[1]*i-20:e[1]+t[1]*i,a.setAttribute("x",o-7*r.length*i),a.setAttribute("y",c),a.innerHTML=r,a}#Tt(e,t){const r=this.#At.y>0&&t<=this.#At.y,s=this.#At.x>0&&e<=this.#At.x;let n,a;r&&(this.#At.y-=t),s&&(this.#At.x-=e),n=0===this.#At.y,a=0===this.#At.x,n&&(this.#At.x2-=e),a&&(this.#At.y2-=t)}#Et(e,t,r,s){return Object.entries(t).map((t=>{const{fillX:n,fillY:a,next:i}=t[1],o=+(r/t[1].values[0]).toFixed(4),c=+(s/t[1].values[1]).toFixed(4),l=e.y===i[1]&&n+o<=1,u=e.x===i[0]&&a+c<=1;l&&(t[1].fillX=+(n+o).toFixed(4)),u&&(t[1].fillY=+(a+c).toFixed(4)),t[1].fillX>=1&&(t[1].next[1]=null),t[1].fillY>=1&&(t[1].next[0]=null)})),this.#Tt(r,s),t}#zt(e,t){const{next:r,pos:s,values:n}=e[t];let a,i,o;for(o in e)o!==t&&(a=s[0]===e[o].pos[0]&&0!==s[0],i=s[1]===e[o].pos[1]&&0!==s[1],a&&s[1]<e[o].next[1]?(s[1]=e[o].next[1],r[1]=s[1]+n[1]):i&&s[0]<e[o].next[0]&&(s[0]=e[o].next[0],r[0]=s[0]+n[0]));return e}#Ot(e,t,r,s,n,a){let i,o,c,l;const u=this.#St.x,h=this.#St.y,d=s.x+r.next[0]===u||this.#At.x===s.x,p=s.y+r.next[1]===h||this.#At.y===s.y;return this.#Et(s,t,n,a),i=p&&s.y*r.fillY===r.next[1]?null:s.x+n,o=d&&s.x*r.fillX===r.next[0]?null:s.y+a,c=null===i||o>=h?1:0,l=null===o||i>=u?1:0,t[e]={values:[n,a],pos:[s.x,s.y],next:[i,o],fillX:c,fillY:l},this.#zt(t,e),t}#Pt(e,t,r){let s,n;const{next:a,pos:i,values:o,fillX:c,fillY:l}=e,u=this.#St.x,h=this.#St.y,d=0===i[0]?a[0]:i[0],p=0===i[1]?a[1]:i[1],m=c+t/o[0]<=1,g=l+r/o[1]<=1,y=null===d&&o[0]+t<=u&&0===i[0],f=null===p&&o[1]+r<=h&&0===i[1];return y||f?(s=y?i[0]:null===p?a[0]:i[0],n=f?i[1]:null===d?a[1]:i[1],0===s&&0===n&&(s=void 0),0===n&&0===n&&(n=void 0),0===s&&c>0&&(s=c*o[0]),0===n&&l>0&&(s=l*o[1])):d+t<=this.#St.x?(s=a[0]+t<=this.#St.x?a[0]:void 0,n=i[1]+r<=this.#St.y?i[1]:void 0):p+r<=this.#St.y&&(s=i[0]+t<=this.#St.x?i[0]:void 0,n=a[1]+r<=this.#St.y?a[1]:void 0),(0===s&&c>0||null===s)&&(s=void 0),!s&&this.#At.y>=r&&(s=~~i[0]),!s&&!m&&g&&(s=~~(c*o[0]+i[0])),0===n&&!g&&(n=void 0),0===n&&g&&(n=l*o[1]+i[1]),0===n&&0===this.#At.x&&(n=~~a[1]),void 0!==s&&void 0!==n&&{x:s,y:n}}#Bt(e,t,r,s){const n=s.at(-1);let a,i,o=s.length;for(i of s)if(o-- >1&&(e[i]&&(a=this.#Pt(e[i],t,r)),a)){this.#Ot(n,e,e[i],a,t,r);break}return e}#Lt(e,t,r,s){let n,a,i,o;return 0===Object.entries(e).length?(n=this.#St.x-t==0?null:t,a=this.#St.y-r==0?null:r,i=this.#At.x+t===this.#St.x?1:0,o=this.#At.y+r===this.#St.y?1:0,e[s]={values:[t,r],pos:[0,0],next:[n,a],fillX:i,fillY:o},this.#Tt(t,r)):this.#Bt(e,t,r,s),e}#Nt(e){const t=document.createDocumentFragment();let r;for(r in e)t.appendChild(this.#kt(e[r])),t.appendChild(this.#bt(e[r],r));return t}#It(){let e,t;const r={},s=[],n="cm - centimeters"===localStorage.getItem("metrica")?"cm":"in";return this.#wt.map((async a=>{if("in"===n){const e=a[0];(a=Array.from(new Converter(a[1],a[2],a[3]).cmConvert)).unshift(e)}'<i class="nf nf-oct-sync"></i>'===a.at(-1)?(e=z(a[3],this.#St.x,this.#vt[0]),t=z(a[1],this.#St.y,this.#vt[2])):(e=z(a[1],this.#St.x,this.#vt[0]),t=z(a[3],this.#St.y,this.#vt[2])),s.push(a[0]),await this.#Lt(r,e,t,s)}),0),this.#Nt(r)}}class LargestRender{#xt;#wt;#vt;constructor({works:e},t,r,s){return this.#xt=t,this.#vt=r,this.#wt=Array.isArray(e[0])?[e[s]]:e,this.#Xt()}#kt({x:e,y:t}){const r=document.createElementNS("http://www.w3.org/2000/svg","rect"),s=t.length>1?B(t):0;return r.setAttribute("x",1),r.setAttribute("y",s+1),r.setAttribute("width",e.at(-1)-20),r.setAttribute("height",t.at(-1)-20),r}#bt({x:e,y:t},r){const s=document.createElementNS("http://www.w3.org/2000/svg","text"),n=e.at(-1),a=.5*t.at(-1),i=.5*n-10*r.length*.5,o=1===t.length?a:B(t)+a;return s.setAttribute("x",i),s.setAttribute("y",o),s.innerHTML=r[0],s}#Xt(){let e;const t=document.createDocumentFragment(),r=[],s=[],n="cm - centimeters"===localStorage.getItem("metrica")?"cm":"in";return this.#wt.map((a=>{if("in"===n){const e=a[0];(a=new Converter(a[1],a[2],a[3]).cmConvert).unshift(e)}r.push(z(a[1],this.#xt.x,this.#vt[0])),s.push(z(a[3],this.#xt.y,a[3])),t.appendChild(this.#kt({x:r,y:s})),e=[{x:r,y:s},a,this.#vt],t.appendChild(this.#bt.apply(null,e))})),t}}function B(e){let t;return 2===e.length?e.at(-2):(t=e.reduce(((e,t)=>e+t),0),t-e.at(-1))}class sameSizeRender{#xt;#wt;#vt;constructor({works:e},t,r,s){return this.#xt=t,this.#vt=r,this.#wt=this.#Yt(e,s),this.#Xt()}#Yt(e,t){const r=this.#vt[2]/e[0][3];let s=[],n=[];return e.map((e=>{n.length===r&&(s.push([...n]),n=[]),n.push(e)})),s[t]}#kt({X:e,Y:t}){const r=document.createElementNS("http://www.w3.org/2000/svg","rect"),s=t.length>1?L(t):0;return r.setAttribute("x",1),r.setAttribute("y",s+1),r.setAttribute("width",e.at(-1)-20),r.setAttribute("height",t.at(-1)-20),r}#bt({X:e,Y:t},r){const s=document.createElementNS("http://www.w3.org/2000/svg","text"),n=e.at(-1),a=.5*t.at(-1),i=.5*n,o=1===t.length?a:L(t)+a;return s.setAttribute("x",i-10*r.length*.5),s.setAttribute("y",o),s.innerHTML=r[0],s}#Xt(){let e;const t=document.createDocumentFragment(),r=[],s=[],n="cm - centimeters"===localStorage.getItem("metrica")?"cm":"in";return this.#wt.map((a=>{if("in"===n){const e=a[0];(a=new Converter(a[1],a[2],a[3]).cmConvert).unshift(e)}r.push(z(a[1],this.#xt.x,this.#vt[0])),s.push(z(a[3],this.#xt.y,this.#vt[2])),t.appendChild(this.#kt({X:r,Y:s})),e=[{X:r,Y:s},a,this.#vt],t.appendChild(this.#bt.apply(null,e))})),t}}function L(e){const t=e.reduce(((e,t)=>e+t),0);return 2===e.length?e.at(-2):t-e.at(-1)}class noCanvasRender{#St;#Ft;#vt;constructor({works:e},t,r){return this.#St=t,this.#vt=r,this.#Ft=e,this.#Xt()}#Wt(e,t){let r,s;const n=X(e,t,this.#St);return e.includes(0)||t.includes(0)?(r=n.x,s=n.y):(r=e.includes(0)||1!==e.length?n.x:0,s=t.includes(0)||e.includes(0)?n.y:0),{posX:r,posY:s}}#kt({X:e,Y:t}){const r=document.createElementNS("http://www.w3.org/2000/svg","rect"),s=this.#Wt(e,t),{x:n,y:a}=this.#St;return r.setAttribute("x",s.posX+1),r.setAttribute("y",s.posY+1),e.at(-1)>=n||s.posX+e.at(-1)+1>=n?r.setAttribute("width",e.at(-1)-20):r.setAttribute("width",e.at(-1)),t.at(-1)>=a||s.posY+t.at(-1)>=a?r.setAttribute("height",t.at(-1)-20):r.setAttribute("height",t.at(-1)),r}#bt({X:e,Y:t},r,s){const n=document.createElementNS("http://www.w3.org/2000/svg","text"),a=.5,i=+N(e).toFixed(0);let o,c;const l=X(e,t,s);return e.includes(0)||t.includes(0)?(o=l.x+(e.at(-1)*a-10*r.length*a),c=l.y+t.at(-1)*a):(o=e.includes(0)?l.x(e.at(-1)*a-10*r.length*a):i+e.at(-1)*a,c=t.includes(0)||e.includes(0)?l.y+t.at(-1)*a:t.at(-1)*a),n.setAttribute("x",o),n.setAttribute("y",c),n.innerHTML=r[0],n}#Rt(e,t,r,s){let n=r,a=[],i=[];for(;n>=0&&0!==e[n];)a.push(e[n]),n--;for(n=r;n>=0&&0!==t[n];)i.push(t[n]),n--;a=a.reduce(((e,t)=>e+t),0),i=i.reduce(((e,t)=>e+t),0),a>=s.x&&e.push(0),i>=s.y&&t.push(0)}#Xt(){let e;const t=document.createDocumentFragment(),r=[],s=[],n="cm - centimeters"===localStorage.getItem("metrica")?"cm":"in";return this.#Ft.map(((a,i)=>{if("in"===n){const e=a[0];(a=new Converter(a[1],a[2],a[3]).cmConvert).unshift(e)}r.push(z(a[1],this.#St.x,this.#vt[0])),s.push(z(a[2],this.#St.y,this.#vt[1])),t.appendChild(this.#kt({X:r,Y:s})),e=[{X:r,Y:s},a,this.#St],t.appendChild(this.#bt.apply(null,e)),this.#Rt(r,s,i,this.#St)})),t}}function N(e){let t;return 2===e.length?e.at(-2):(t=e.reduce(((e,t)=>e+t),0),t-e.at(-1))}function X(e,t,r){let s,n,a,i=0,o=0;const c=N(e),l=N(t);return e.map((e=>0===e&&i++)),t.map((e=>0===e&&o++)),s=c-i*r.x,n=c<r.x||l<r.y?0:l-o*r.y,0===s&&t.includes(0)&&(a=t.indexOf(r.y),s=a>=0?e[a]:e[t.indexOf(0)-1]),n>=r.y&&(n=l-o*r.y-t.at(-1)),{x:s,y:n}}function Y({type:e,crate:t,works:r},s){const n=function(){const e=document.querySelector(".crate-layer");if(e.parentNode)for(;e.firstChild;)e.removeChild(e.firstChild);return e}(),a=globalThis.screen.availWidth,i=[t[0]-23,t[1]-23,t[2]-28];let o;switch(o=O(a,[i[0],i[2]]),n.setAttribute("width",o.x),n.setAttribute("height",o.y),e){case"tubeCrate":n.appendChild(new TubeRender(r,o,i));break;case"largestCrate":n.appendChild(new LargestRender(r,o,i,s));break;case"sameSizeCrate":n.appendChild(new sameSizeRender(r,o,i,s));break;case"noCanvasCrate":o=O(a,[i[0],i[1]]),n.setAttribute("width",o.x),n.setAttribute("height",o.y),n.appendChild(new noCanvasRender(r,o,i));break;case"standardCrate":n.appendChild(new StandardRender(r,o,i,s))}return n}async function F(){const e=await async function(e){const t=new Worker(new URL("./panels/worker.IDB.crates.mjs",import.meta.url),{type:"module"});let r;return t.postMessage(e),r=await new Promise(((r,s)=>{t.onmessage=t=>{const{data:n}=t;n.reference===e?r(n.crates):s(t)}})),r}(localStorage.getItem("refNumb")),t=document.getElementById("selected-crate"),r="cm - centimeters"===localStorage.getItem("metrica")?"cm":"in";if(t.hasChildNodes())for(;t.firstChild;)t.removeChild(t.firstChild);t.innerHTML=e.allCrates.map(((e,t)=>`\n\t\t\t<option>\n\t\t\t\tCrate ${++t} - ${e[0]} x ${e[1]} x ${e[2]} - ${r}\n\t\t\t</option>\n\t\t`),0),await async function(e,t){if("in"===e){const e=structuredClone(t);Object.entries(e).map((e=>{let t;for(t in e)e[t].hasOwnProperty("crates")&&(e[t].crates=e[t].crates.map(((e,t)=>(t%2==0&&(e=new Converter(e[0],e[1],e[2]).cmConvert),e)),0))})),localStorage.setItem("doneList",JSON.stringify({...e}))}else localStorage.setItem("doneList",JSON.stringify({...t}))}(r,e),await U(e)}function W(){const e=document.getElementById("layers"),t=function(){const e=JSON.parse(localStorage.getItem("doneList"));let t,r,s,n=document.getElementById("selected-crate").value.split(" ")[1];for(t in e)e[t]?.hasOwnProperty("crates")&&e[t].crates.map(((a,i)=>{Array.isArray(a)&&0==--n&&(r=e[t].crates[i+1],s={type:t,crate:a,works:r})}),0);return s}(),r=+sessionStorage.getItem("numLayer");e.appendChild(Y(t,r-1))}function R(e,t,r){let s;return"sameSizeCrate"===r?e[r].crates.map(((n,a)=>{if(0===t&&void 0===s){const t=28,i=e[r].crates[a-1][2]===n.works[0][3]+n.works[1][3]+t;s=i?n.works.length/2:n.works.length}(a%2==0||0===a)&&t--}),0):e[r].crates.map(((e,n)=>{0===t&&n%2==1&&(s="tubeCrate"===r||"noCanvasCrate"===r?1:e.works.length),(n%2==0||0===n)&&t--}),0),{layers:s,counter:t}}async function U(e){let t,r,s=+document.getElementById("selected-crate").value.split(" ")[1],n=e??JSON.parse(localStorage.getItem("doneList"));for(r in n)n[r].hasOwnProperty("crates")&&s>0&&n[r].crates.length>0&&(t=R(n,s,r),s=t.counter);sessionStorage.setItem("layers",t.layers),sessionStorage.setItem("numLayer",1),D()}function D(e){const t=sessionStorage.getItem("layers"),r=document.getElementById("layer-count");r.innerText=void 0===e?`Current layer: 1 / ${t}`:`Current layer: ${e} / ${t}`}function _(e){const t=sessionStorage,r=Number.parseInt(t.getItem("layers")),s=Number.parseInt(t.getItem("numLayer"));let n;"next"===e.target.id||"layer-next"===e.target.id?(n=s+1,n<=r?(D(n),t.setItem("numLayer",n),n--):(n=r-1,t.setItem("numLayer",r))):(n=s-1,n>=1?(D(n),t.setItem("numLayer",n)):(n=1,t.setItem("numLayer",n))),$(),W()}function $(){const e=document.querySelector(".crate-layer");if(e.hasChildNodes())for(;e.firstChild;)e.removeChild(e.firstChild)}function j(e,t){e.map((e=>{e&&(e.setAttribute("aria-hidden",!1),e.setAttribute("aria-expanded",!0))}))}async function q(){const e=document.getElementById("show-layer"),t=document.getElementById("Render").content.cloneNode(!0),r=document.getElementById("input_estimate").value,s=t.childNodes[1],n=t.childNodes[1].children[0].children[1];if(!r)return alert("Please, add some works and press the 'Crate' button.");if(!1===e.hasChildNodes())e.appendChild(t),j([s,n]);else!function(e,t){e.map((e=>{for(e.setAttribute("aria-hidden",!0),e.setAttribute("aria-expanded",!1);t.firstChild;)t.removeChild(t.firstChild)}))}([s,n],e);"false"===s.ariaHidden&&(await F(),J(),setTimeout((()=>globalThis.scroll({top:1e3,behavior:"smooth"})),1e3))}function J(){const e=document.getElementById("layers"),t=function(){const e=JSON.parse(localStorage.getItem("doneList"));let t,r,s,n=document.getElementById("selected-crate").value.split(" ")[1];for(t in e)e[t]?.hasOwnProperty("crates")&&e[t].crates.map(((a,i)=>{Array.isArray(a)&&0==--n&&(r=e[t].crates[i+1],s={type:t,crate:a,works:r})}),0);return s}(),r=+sessionStorage.getItem("numLayer");e.appendChild(Y(t,r-1))}if(globalThis.onload=()=>{const e=localStorage.getItem("mode");V(),null===e&&localStorage.setItem("mode","light"),Z(),function(){const e=localStorage.getItem("mode"),t=document.body;switch(e){case"light":document.getElementById("light-mode").checked=!0,t.classList.remove("dark-mode"),t.classList.toggle("light-mode");break;case"dark":document.getElementById("dark-mode").checked=!0,t.classList.remove("light-mode"),t.classList.toggle("dark-mode")}}(),setTimeout(G,1500)},!localStorage.getItem("metrica")){const e=document.getElementById("cm").value;localStorage.setItem("metrica",e)}function M(){const e=localStorage.getItem("metrica"),t=confirm("Attention! You are going to change the measurement of the works.");if(e&&void 0!==e){if(t){"cm - centimeters"===localStorage.getItem("metrica")?localStorage.setItem("metrica","in - inches"):localStorage.setItem("metrica","cm - centimeters"),sessionStorage.setItem("clean","reload")}}else localStorage.setItem("metrica",document.getElementById("cm").value);Z()}const H=()=>{V(),g();const e=document.querySelector(".result");sessionStorage.getItem("codes")&&("true"===e.ariaHidden&&j([e]),setTimeout((()=>globalThis.scroll({top:300,behavior:"smooth"})),1e3))};function G(){const e=document.querySelector(".loading"),t=document.querySelector(".app"),r=document.querySelector(".footer-content");e.style.display="none",e.setAttribute("aria-hidden",!0),t.setAttribute("aria-hidden",!1),r.setAttribute("aria-hidden",!1)}function V(){const e=localStorage.getItem("refNumb");return e&&(document.getElementById("input_estimate").value=e),l(),function(){const e="off_line_results",t=globalThis.indexedDB.open(e);t.onerror=e=>{alert(`ATTENTION! ${e.target.errorCode}`)},t.onupgradeneeded=t=>{let r;r=t.target.result.createObjectStore(e,{keyPath:"reference"}),r.createIndex("reference","reference",{unique:!0})}}(),p()&&m()&&d()}function Z(){switch(localStorage.getItem("metrica")){case"cm - centimeters":document.getElementById("cm").checked=!0;break;case"in - inches":document.getElementById("in").checked=!0}}function K({works:e}){let t=[];const r=Array.isArray(e[0][0])?e[0]:e;return r?.map((e=>{let r;if(Array.isArray(e))return t.push(e);for(r in e)t.push(r),1===e[r].length?t.push(e[r][0]):Array.isArray(e[0])?e[r][0].map((e=>t.push(e))):e[r].map((e=>t.push(e)))})),t}function Q(e){if(!e)return"There is no crates. Please, try again!";const t="cm - centimeters"===localStorage.getItem("metrica")?"cm":"in",r=e.map((e=>{let r;return"string"==typeof e?`LAYER layer ${e?.at(-1)}:`:e.length>=5?(r=`CODE: ${e[0]} - ${e[1]} x ${e[2]} x ${e[3]} - ${t}`,r):4===e.length?(r=`CRATE: ${e[0]} x ${e[1]} x ${e[2]} - ${t}`,r):void 0})),s=function(e,t){for(;t--;)e=(e=(e=(e=(e=e.replace("LAYER","\t")).replace("CODE: ","\t\t")).replace('"',"")).replace('"',"")).replace(",","\n");return e=(e=e.replace("[","")).replace("]","")}(JSON.stringify(r),r.length);navigator.clipboard.writeText(s)}function ee(){const e=new Worker(new URL("./panels/worker.IDB.crates.mjs",import.meta.url),{type:"module"}),t=document.getElementById("input_estimate").value;if(!sessionStorage.getItem(t))return alert('Please, press the "Crate" button if already added works.');e.postMessage(t),e.onmessage=e=>!!Array.isArray(e.data.crates)&&function({crates:e}){return sessionStorage.setItem("copy1","done!"),Q(e.allCrates)}(e.data)}function te(){const e=new Worker(new URL("./panels/worker.IDB.crates.mjs",import.meta.url),{type:"module"}),t=document.getElementById("input_estimate").value;if(!sessionStorage.getItem(t))return alert('Please, press the "Crate" button if already added works.');e.postMessage(t),e.onmessage=e=>function({crates:e}){let t,r,s=[];for(t in e)e[t].hasOwnProperty("crates")&&e[t].crates.map(((e,t)=>{switch(t%2){case 0:s.push(e);break;case 1:r=K(e),r.map((e=>s.push(e))),r=null}}),0);return sessionStorage.setItem("copy2","done!"),Q(s)}(e.data)}function re(e){localStorage.setItem("mode",e),function(e){const t=document.body.classList;t.remove("light-mode"),t.remove("dark-mode"),"dark"===e?t.add("dark-mode"):t.add("light-mode")}(e)}function se(e){const t=e.target.closest(".accordion-panel");if("body-app"===e.target.id)return ne();t&&function(e){const t=e.parentElement.querySelectorAll("button"),r=e.parentElement.querySelectorAll(".menu__input");t.forEach((e=>{e.setAttribute("aria-expanded",!1)})),r.forEach((e=>{e.setAttribute("aria-hidden",!0)})),function(e){e.querySelector("button").setAttribute("aria-expanded",!0),e.querySelector(".menu__input").setAttribute("aria-hidden",!1),globalThis.document.getElementById("estimate_getter").select()}(e)}(t)}function ne(){const e=document.querySelector(".accordion-panel");let t,r,s;for(t in e)r=e.parentElement.querySelectorAll("button"),s=e.parentElement.querySelectorAll(".menu__input"),r.forEach((e=>{e.setAttribute("aria-expanded",!1)})),s.forEach((e=>{e.setAttribute("aria-hidden",!0)}))}function ae(){const e=document.querySelector(".side-menu");e?.getElementsByTagName("padding-dialog")?.length>0&&sessionStorage.setItem("CLOSED","NOW"),p(),m(),d()}function ie(e){const t=[];return e.map((e=>{const{code:r,x:s,z:n,y:a}=e;t.push({code:r,x:s,z:n,y:a})})),t}async function oe(e){const t=new Worker(new URL("./panels/worker.IDB.crates.mjs",import.meta.url),{type:"module"}),r=await new Promise(((r,s)=>{t.postMessage(e),t.onmessage=e=>{void 0!==e?r(e.data):s(void 0)}}));return!!r&&(document.getElementById("input_estimate").value=e,sessionStorage.setItem("FETCHED",JSON.stringify(r)),ae(),ce([r]),"IDB data Found.")}async function ce(e){try{if(!(e.length>0||e?.hasOwnProperty("crates")))throw new TypeError("Data not found!");{const{crates:t,works:r,reference_id:s}=e[0],n={crates:t,list:e[1]?.hasOwnProperty("crates")?ie(e[1]):ie(r.list),reference:s},a=JSON.stringify(n);document.getElementById("input_estimate").value=s,globalThis.sessionStorage.clear(),globalThis.sessionStorage.setItem("FETCHED",a),ae()}}catch(e){return e}}async function le(e){const t=`/estimates/${e}`,r={"Content-Type":"application/json; charset=UTF-8"};if(globalThis.navigator.onLine){let e;return await fetch(t,{method:"GET",headers:r}).then((t=>(e=t.json(),e))).then(ce),e}}async function ue(){const e=document.getElementById("estimate_getter").value,t=(r=document.getElementById("input_estimate").value,async e=>{r&&r!==e&&y(!0)});var r;if(!function(e){switch(/[^-a-z-A-Z-0-9]/g.test(e)){case!0:return alert("Found special character NOT allowed. Please, try again!"),!0;case!1:return!1}}(e)){const r=[oe(e),le(e)];await Promise.all(r).then((async r=>{r[0]||0!==r[1].length?await Promise.resolve(t(e)).then((async()=>{if(r[1].length>0){u({reference:r[1][0].reference_id,crates:r[1][0].crates.crates,list:r[1][0].works.list},!0)}else g(!0)})):alert("Document not found! Please, try again.")}))}}async function he(){if(confirm("Are you sure to logout?")){globalThis.location.replace("/otto/login/");try{await fetch("/logout",{method:"GET",cookie:"id=deleted; sessin=deleted; name=deleted; expires=Thu, 01 Jan 1970 00:00:00 GMT",headers:{"Content-Type":"application/json; charset=UTF-8"}}).then((e=>console.log(e))).catch((e=>console.error(`Alert ${e}`)))}catch(e){alert(`Attention: ${e}`)}}}globalThis.onkeydown=e=>{const t="Enter"===e.key&&!0===e.ctrlKey,r=!0===e.ctrlKey&&"V"===e.key,s="Escape"===e.key;t&&H(),r&&q(),s&&ne()},globalThis.document.getElementById("main-app").addEventListener("click",(e=>{switch(e.target.id){case"body-app":case"seek-btn":case"search-header":case"units-header":case"button-seek":case"search-btn":case"unit-btn":case"units-btn":se(e);break;case"buttonInstall":!async function(){globalThis.hideInstallPromotion(),globalThis.deferredPrompt.prompt();const{outcome:e}=await deferredPrompt.userChoice;console.log(`User response to the install prompt: ${e}`),globalThis.deferredPrompt=null}();break;case"add-btn":v();break;case"remove-btn":C();break;case"clear-btn":(()=>{const e=localStorage.getItem("mode"),t=localStorage.getItem("metrica"),r=document.querySelector(".result"),s=document.getElementById("layers"),n=document.querySelector(".plotter__menu");confirm("Do you really want to delete the whole list?")&&(y(),localStorage.clear(),sessionStorage.clear(),sessionStorage.setItem("clean","eraser"),localStorage.setItem("mode",e),localStorage.setItem("metrica",t),globalThis.document.getElementById("input_estimate").value="",j([r,s,n]))})();break;case"crate-btn":case"crate_btn":H();break;case"copy-pane1":ee();break;case"copy-pane2":te();break;case"logout":case"logout-btn":he();break;case"exchange-header":A(),async function(){const e=sessionStorage.getItem("currency"),t=JSON.parse(sessionStorage.getItem("coin1")),r=JSON.parse(sessionStorage.getItem("coin2")),s=document.getElementById("coin1"),n=document.getElementById("coin2");null!==t&&(s.value=t),null!==r&&(n.value=r),null===e&&await w()}(),se(e);break;case"ex-btn":case"exchange-btn":A(),se(e);break;case"fetch-btn":ue();break;case"crate-layers":case"layer-crate":q();break;case"previous":case"layer-prev":case"next":case"layer-next":_(e)}}),!0),globalThis.document.getElementById("main-app").addEventListener("change",(e=>{switch(e.preventDefault(),e.target.id){case"input_estimate":l();break;case"in":case"cm":M();break;case"dark-mode":re("dark");break;case"light-mode":re("light");break;case"coin1":!function(){const e=document.getElementById("coin1").value,t=document.getElementById("coin1-input");sessionStorage.setItem("coin1",JSON.stringify(e)),S(e,t)}();break;case"coin2":!function(){const e=document.getElementById("coin2").value,t=document.getElementById("coin2-input");sessionStorage.setItem("coin2",JSON.stringify(e)),S(e,t)}();break;case"units1":!function(){const e=globalThis.document.getElementById("input-unit1"),t=globalThis.document.getElementById("input-unit2");e.value=0,t.value=0}();break;case"units2":!function(){const e=globalThis.document.getElementById("input-unit1"),t=globalThis.document.getElementById("input-unit2");e.value=0,t.value=0}();break;case"selected-crate":U(),function(){const e=document.getElementById("selected-crate").value;$(),J(e.split(" ")[1])}()}}),!0),globalThis.document.getElementById("main-app").addEventListener("input",(e=>{switch(e.target.id){case"coin1-input":!function(){const e=document.getElementById("coin1").value,t=document.getElementById("coin2").value,r=document.getElementById("coin1-input"),s=document.getElementById("coin2-input");S(t,s),s.value=`$ ${b(e,t,r,s)}`}();break;case"coin2-input":!function(){const e=document.getElementById("coin1").value,t=document.getElementById("coin2").value,r=document.getElementById("coin1-input"),s=document.getElementById("coin2-input");S(e,r),r.value=`$ ${b(e,t,r,s)}`}();break;case"input-unit1":!function(){const e=globalThis.document.getElementById("units1").value,t=globalThis.document.getElementById("units2").value,r=globalThis.document.getElementById("input-unit1"),s=globalThis.document.getElementById("input-unit2");s.value=0,s.value=I(e,t,r,s)}();break;case"input-unit2":!function(){const e=globalThis.document.getElementById("units1").value,t=globalThis.document.getElementById("units2").value,r=globalThis.document.getElementById("input-unit1"),s=globalThis.document.getElementById("input-unit2");r.value=0,r.value=I(e,t,r,s)}()}}),!0),globalThis.onsubmit=e=>{e.preventDefault()},globalThis.document.getElementById("estimate_getter").addEventListener("keypress",(e=>{"Enter"===e.key&&ue()})),globalThis.navigator.serviceWorker.register("./sw.mjs"),globalThis.addEventListener("beforeinstallprompt",(e=>{e.preventDefault(),console.log("👍","beforeinstallprompt",e),globalThis.deferredPrompt=e}));
